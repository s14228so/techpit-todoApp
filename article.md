
# ã¯ã˜ã‚ã«
æ˜¨ä»ŠSPAã®çˆ†ç™ºçš„äººæ°—ã«ä¼´ã„ã€Railså˜ä½“ã®ã‚ˆã†ãªãƒ¢ãƒãƒªã‚·ãƒƒã‚¯ãªã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã¯ãªãã€
SPAã¨APIã‚’ãã‚Œãã‚Œç”¨æ„ã—ãƒ•ãƒ­ãƒ³ãƒˆã¨ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚’å®Œå…¨ã«åˆ†é›¢ã™ã‚‹é–‹ç™ºæ‰‹æ³•ãŒãƒˆãƒ¬ãƒ³ãƒ‰ã§ã‚‚ã‚ã‚Šã¾ã™ã€‚
ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚’APIã¨ã—ã¦é–‹ç™ºã—ã¦ã„ã‚Œã°ã€ãƒã‚¤ãƒ†ã‚£ãƒ–ã‚’é–‹ç™ºã™ã‚‹æ™‚ã‚‚åŒã˜APIã‚’ä½¿ãˆã‚‹ã€åˆ†æ¥­ã—ã‚„ã™ã„ãªã©å¤šãã®ãƒ¡ãƒªãƒƒãƒˆãŒã‚ã‚‹ã¨æ€ã„ã¾ã™ã€‚
ãŸã ã€Reactã‚„Vueã§SPAã®é–‹ç™ºæ‰‹æ³•ã¯ã‚ã‚‹ç¨‹åº¦ç†è§£ã—ã¦ã„ã¦ã‚‚ã€ã“ã‚Œã‚’å®Ÿéš›ã«ã©ã†APIã¨é€£æºã—ãªãŒã‚‰é–‹ç™ºã—ã¦ã„ãã®ã‹ã‚’è§£èª¬ã™ã‚‹æ•™æã¯ã¾ã ã¾ã å°‘ãªã„ã§ã™ã€‚
ä»Šå›ã¯ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã«Rails APIã€ãƒ•ãƒ­ãƒ³ãƒˆã¯Nuxtã€èªè¨¼ã¯Firebaseã‚’ä½¿ã„ã¾ã™ãŒã€
ã‚ãã¾ã§ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã¨ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚’åˆ†ã‘ã¦é–‹ç™ºã—ã¦ãã‚Œã‚’ã©ã†é€£æºã•ã›ã‚‹ã®ã‹ã‚’ç†è§£ã™ã‚‹ã“ã¨ãŒé‡è¦ã§ã™ã€‚


## ã“ã‚“ãªæ–¹ã«ãŠã™ã™ã‚
ãƒ»ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã¨ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚’åˆ†ã‘ã¦é–‹ç™ºã™ã‚‹æ‰‹æ³•ã‚’å­¦ã³ãŸã„æ–¹ã€‚
ãƒ»ã‚ã£ã¡ã‚ƒè¨˜äº‹ãŒé•·ã„ã®ã§æ ¹æ€§ãŒã‚ã‚‹æ–¹

## ç’°å¢ƒ

Mac 
Rails 6.0.2.1
ruby 2.5.3
npm 6.13.4


## ã“ã®è¨˜äº‹ã‚’èª­ã‚€ã«ã‚ãŸã£ã¦ã®å‰æ
ãƒ»Railsã§ä½•ã‹ã—ã‚‰ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½œæˆã—ãŸã“ã¨ãŒã‚ã‚‹
ãƒ»JavaScriptåŠã³Vue.jsã®åŸºæœ¬çŸ¥è­˜ãŒã‚ã‚‹
ãƒ»Nuxtã‚„Vuexã®çŸ¥è­˜ãŒã‚ã‚‹ã¨å°šè‰¯ã„ã§ã™ã€‚
(ã»ã¼Vue,Nuxt,Vuexã®èª¬æ˜ã¯å‰²æ„›ã•ã›ã¦ã„ãŸã ãã¾ã™ğŸ™‡â€â™‚ï¸ï¼‰

## å®Œæˆå“
https://qiita-todo.firebaseapp.com

## GitHubã®ãƒªãƒã‚¸ãƒˆãƒª
Github => https://github.com/s14228so/Qiita-todo


## ç›®æ¬¡

| ç›®æ¬¡        |   
|:-------------------|
| 1. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä½œæˆ  |                       
| 2. Rails APIã®è²¬å‹™    |           
| 3. ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ä½œæˆ |           
| 4.  Firebase Authentication  |    
| 5.  CORSã«ã‚ˆã‚‹é€šä¿¡  |             
| 6. ãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ…‹ã®ä¿æŒ(vuex)   |  
| 7. Loadingã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ä½œæˆ  |  
| 8. SuccessMessageã®è¡¨ç¤º |  
| 9. ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã‚¬ãƒ¼ãƒ‰  |  
| 10. Herokuã¨Firebaseã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤   |           


# ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä½œæˆ
ã•ã‚ã“ã“ã‹ã‚‰å®Ÿè£…ã«å…¥ã£ã¦ã„ãã¾ã™ã€ã‹ãªã‚Šé•·ã„ã§ã™ãŒãŠä»˜ãåˆã„ãã ã•ã„ï¼

```
$ mkdir todoApp; cd $_
$ rails new api --api (Railsã‚’APIã§ä½œã‚‹)
$ npx create-nuxt-app web (Nuxtã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ)
```


Nuxtã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆæ™‚ã«è‰²ã€…è³ªå•ã‚’èã‹ã‚Œã¾ã™ãŒã€ä»¥ä¸‹ã®è³ªå•ã ã‘ã‚¹ãƒšãƒ¼ã‚¹ã‚­ãƒ¼ã‚’æŠ¼ã—ã¦é¸æŠã—ã¾ã™

```
? Choose UI framework => Vuetify.js
? Choose Nuxt.js modules => Axios
? Choose rendering mode => Single Page App
```

CSSãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã¯[Vuetify](https://vuetifyjs.com/ja/)ã‚’é¸ã³ã¾ã™ã€‚
[axios](https://github.com/axios/axios)ã¯Railsã®APIã¨é€šä¿¡ã™ã‚‹ãŸã‚ã«ä½¿ã†ã®ã§äºˆã‚å…¥ã‚Œã¦ãŠãã¾ã™ã€‚ä»Šå›SSRã¯ä¸è¦ãªã®ã§SPAãƒ¢ãƒ¼ãƒ‰ã§ä½œæˆã—ã¾ã™ã€‚


ä»–ã®è³ªå•ã¯Enterã‚’æŠ¼ã—ã¦ãŠã‘ã°ã§å¤§ä¸ˆå¤«ã§ã™ã€‚

ä»Šå›ã‚ã‹ã‚Šã‚„ã™ãã‚ã–ã¨ä¸Šã®éšå±¤ã§ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’åˆ‡ã‚ŠGithubã‚‚åŒä¸€ã®ãƒªãƒã‚¸ãƒˆãƒªã«ã—ã¦ã„ã¾ã™ãŒ(monorepoæ§‹æˆ)ã€çš†ã•ã‚“ã¯åˆ¥ã®ãƒªãƒã‚¸ãƒˆãƒªã«ã—ã¦ã‚‚ã‚‰ã£ã¦æ§‹ã„ã¾ã›ã‚“ã€‚
åŒä¸€ãƒªãƒã‚¸ãƒˆãƒªã¨ã—ã¦ç®¡ç†ã—ãŸã„ã®ã§ã€
railsã¨nuxtã§è‡ªå‹•ç”Ÿæˆã•ã‚Œã¦ã„ã‚‹gitã‚’å‰Šé™¤ã—ã¾ã™ã€‚

```
$ rm -rf api/.git web/.git
```


ã•ã‚ã€ä¸‹æº–å‚™ãŒã§ããŸã®ã§ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã‚’äºŒã¤é–‹ã„ã¦ã€å„ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ç§»å‹•ã—ã€ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã¨ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®äºŒã¤ã®ã‚µãƒ¼ãƒã‚’ç«‹ã¡ä¸Šã’ã¾ã—ã‚‡ã†ã€‚

ã“ã®æ™‚æ³¨æ„ã—ãªã‘ã‚Œã°ã„ã‘ãªã„ã“ã¨ãŒ1ã¤ã‚ã‚Šã¾ã™ã€‚
Nuxtã‚‚Railsã‚‚ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§3000ç•ªãƒãƒ¼ãƒˆã‚’ä½¿ç”¨ã™ã‚‹ä»•æ§˜ãªã®ã§ã€
Nuxtã®ãƒãƒ¼ãƒˆã¯8080ã«ã—ã¦è¡çªã—ãªã„ã‚ˆã†ã«ã—ã¦ãŠãå¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚


é–‹ç™ºç”¨ã‚µãƒ¼ãƒã®ãƒãƒ¼ãƒˆç•ªå·ã‚’å¤‰æ›´ã™ã‚‹ã«ã¯
nuxt.config.jsã«ä»¥ä¸‹ã®3è¡Œã‚’è¿½åŠ ã—ã¾ã™ã€‚

nuxt.config.js
```
import colors from 'vuetify/es5/util/colors'

export default {
  server: {ã€€// <= è¿½åŠ 
    port: 8080 
  },
```

ã•ã‚ã€äºŒã¤ã®ã‚µãƒ¼ãƒã‚’ç«‹ã¡ä¸Šã’ã¾ã—ã‚‡ã†ã€‚

```
api $ rails s
web $ npm run dev
```


<img width="1431" alt="ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ 2020-01-02 23.56.55.png" src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/251768/e4888544-cf76-326f-c33c-fa56effd15e1.png">
<img width="1422" alt="ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ 2020-01-02 23.56.47.png" src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/251768/35c6ec7e-97a6-8d36-8dcc-2e0b14e4e32f.png">

ç«‹ã¡ä¸Šã’ã‚‹ã¨ã“ã‚“ãªæ„Ÿã˜ã«ãªã‚Šã¾ã™ã€‚


## Railsã§APIã‚’ä½œæˆã—ã¦ã„ã

```
api $ rails g model Todo title:string user_id:integer
api $ rails g controller v1::todos 
api $ rails g model User name:string email:string uid:string
api $ rails g controller v1::users 
api $ rails db:migrate
```

â€»v1ã¨ã„ã†åå‰ç©ºé–“ã§åŒºåˆ‡ã‚‹ã“ã¨ã§ã€APIã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ä¸ãˆã¦ã„ã¾ã™ã€‚

ã‚¢ã‚½ã‚·ã‚¨ãƒ¼ã‚·ãƒ§ãƒ³ã‚’çµ„ã¿ã¾ã™ã€‚

```models/user.rb
class User < ApplicationRecord
    has_many :todos
end
```

```models/todo.rb
class Todo < ApplicationRecord
    belongs_to :user
end
```

ä»Šå›ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãªã©ã¯çœç•¥ã—ã¾ã™ã€‚

```routes.rb
Rails.application.routes.draw do
  namespace :v1 do
    resources :todos, only: [:create, :destroy]
    resources :users, only: [:index, :create]
  end
end
```



# Rails APIã®è²¬å‹™

Railså˜ä½“ã§ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½œæˆã—ã¦ã„ã‚‹ã¨ã€ãƒ–ãƒ©ã‚¦ã‚¶ã‹ã‚‰ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã«å¯¾ã—ã¦**HTML**ã‚’è¿”ã—ã¦ã„ã¾ã—ãŸã€‚ä»Šå›ã¯ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒNuxtã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‹ã‚‰ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆãªã®ã§ã€HTMLã§ã¯ãªã**ãƒ‡ãƒ¼ã‚¿**ã‚’è¿”ã—ã¾ã™ã€‚
ã™ãªã‚ã¡**json**ã‚’è¿”ã™å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

ä½•ã‹ã—ã‚‰ä»Šã¾ã§ä½œæˆã—ã¦ããŸRailsã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’èµ·å‹•ã•ã›ã¦ãƒ‡ã‚£ãƒ™ãƒ­ãƒƒãƒ‘ãƒ¼ãƒ„ãƒ¼ãƒ«ã®Networkã‚¿ãƒ–ã‚’ç¢ºèªã™ã‚‹ã¨ç†è§£ã—ã‚„ã™ã„ã¨æ€ã„ã¾ã™ã€‚
ãƒ‡ã‚£ãƒ™ãƒ­ãƒƒãƒ‘ãƒ¼ãƒ„ãƒ¼ãƒ«ã‚’é–‹ãâ‡¨Networkã‚¿ãƒ–ã‚’ã‚¯ãƒªãƒƒã‚¯â‡¨localhostã‚’ã‚¯ãƒªãƒƒã‚¯â‡¨Responceã‚¿ãƒ–
å€‹åˆ¥ã®HTMLãƒ•ã‚¡ã‚¤ãƒ«ãŒãƒ¬ã‚¹ãƒãƒ³ã‚¹ã¨ã—ã¦è¿”ã£ã¦ãã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã§ããŸã§ã—ã‚‡ã†ã‹ã€‚
<img width="1435" alt="ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ 2020-01-05 9.07.29.png" src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/251768/d5e29aba-2ff7-c45a-45cf-b5e65eea6f52.png">


jsonå½¢å¼ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¿”ã™ãŸã‚ã«ä¾¿åˆ©ãªGem[ActiveModelSerializers](https://github.com/rails-api/active_model_serializers)ã‚’å…¥ã‚Œã¾ã™ã€‚

```Gemfile.rb
gem 'active_model_serializers'
```


```terminal
api $ bundle install
api $ rails g serializer user //Userãƒ¢ãƒ‡ãƒ«ç”¨ã®serializerã‚’ä½œæˆ
api $ rails g serializer todoã€€//Todoãƒ¢ãƒ‡ãƒ«ç”¨ã®serializerã‚’ä½œæˆ
```


```serializers/user_serializer.rb
class UserSerializer < ActiveModel::Serializer
  attributes :id, :name, :email
  has_many :todos 
end
```
ã“ã“ã§has_many :todos ã¨æ›¸ãã“ã¨ã§ãã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«é–¢é€£ã™ã‚‹Todoãƒ¬ã‚³ãƒ¼ãƒ‰ã‚‚ä¸€ç·’ã«é…åˆ—ã§jsonã«å«ã‚“ã§ãã‚Œã¾ã™ã€‚


```serializers/todo_serializer.rb
class TodoSerializer < ActiveModel::Serializer
  attributes :id, :title, :user_id, :username
  belongs_to :user

  def username
    object.user.name
  end
end
```
åŒæ§˜ã«belongs_to :userã¨æ›¸ãã“ã¨ã§ãã®Todoã«é–¢é€£ã™ã‚‹Userãƒ¬ã‚³ãƒ¼ãƒ‰ã‚‚ä¸€ç·’ã«ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§jsonã«å«ã‚“ã§ãã‚Œã¾ã™ã€‚
object.user.nameã§usernameã‚’å®šç¾©ã—ã€ãã‚Œã‚’todoã®attributesã«è¿½åŠ ã™ã‚‹ã“ã¨ã§ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼åã‚‚ä¸€ç·’ã«è¿”ã™ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚


## ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ã®è¨˜è¿°
ä»Šå›ã¯æœ€ä½é™ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã—ã‹ä½œæˆã—ã¦ã„ã¾ã›ã‚“ã€‚é©å®œåŠ ãˆã¦ãã ã•ã„ã€‚
ã“ã“ã®èª¬æ˜ã¯çœç•¥ã—ã¾ã™ã€‚renderã®å¾Œã«**json**ã‚’æŒ‡å®šã—ã¦ã„ã‚‹ã¨ã“ã‚ãŒãƒã‚¤ãƒ³ãƒˆã§ã™ã€‚
renderã®å¾Œã«ä½•ã‚‚æŒ‡å®šã—ãªã„ã¨ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§htmlã‚’è¿”ã™ã®ã§ä»Šã¾ã§ã¯HTMLãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¿”ã—ã¦ã„ãŸæ„Ÿã˜ã§ã™ã€‚

```v1/todos_controller.rb
class V1::TodosController < ApplicationController
    def create
      todo = Todo.new(todo_params)
      if todo.save
        render json: todo, status: :created
      else
        render json: todo.errors, status: :unprocessable_entity
      end
    end

    def destroy
      todo = Todo.find(params[:id])
      if todo.destroy
        render json: todo
      end
    end
  
    private

    def todo_params
      params.require(:todo).permit(:title, :user_id)
    end
end

```



```v1/users_controller.rb
class V1::UsersController < ApplicationController
    def index
        users = User.all
        render json: users
    end

    def create
      user = User.new(user_params)
      if user.save
        render json: user, status: :created
      else
        render json: user.errors, status: :unprocessable_entity
      end
    end

    private

    def user_params
      params.require(:user).permit(:email, :uid, :name)
    end
end
```

ã“ã‚Œã§æœ€ä½é™jsonã‚’è¿”ã™APIã‚µãƒ¼ãƒãŒå®Œæˆã—ã¾ã—ãŸã€‚

http://localhost:3000/v1/users
ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦[]ã¨ã„ã†ç©ºã®é…åˆ—ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚Œã°OKã§ã™ï¼


â€»ã€€ä»Šå¾Œã®ãŸã‚ã«JSONViewã¨ã„ã†Chromeæ‹¡å¼µã‚’å…¥ã‚Œã¦ãŠãã®ãŒãŠã™ã™ã‚ã§ã™ã€‚
ãƒ–ãƒ©ã‚¦ã‚¶ä¸Šã§jsonã‚’è¡¨ç¤ºã™ã‚‹éš›ã«å‹æ‰‹ã«æ•´å½¢ã—ã¦ãã‚Œã‚‹ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚
https://chrome.google.com/webstore/detail/jsonview/chklaanhfefbnpoihckbnefhakgolnmc


# Nuxtå´ã§ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ä½œæˆ
Nuxtã®è‡ªå‹•ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã«ã¤ã„ã¦ã¯[å…¬å¼](https://ja.nuxtjs.org/guide/routing/)ã‚’èª­ã‚“ã§ãã ã•ã„ã€‚
ã–ã£ãã‚Šè¨€ã†ã¨pagesãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç½®ãã¨è‡ªå‹•ã§ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã—ã¦ãã‚Œã¾ã™ã€‚
(ä¾‹)
pages/about.vue => localhost:3000/about
pages/users/_id.vue => localhost:3000/users/:id

ãƒ“ãƒ«ãƒ‰ã•ã‚ŒãŸ**.nuxtãƒ•ã‚©ãƒ«ãƒ€**ã«**router.js**ã¨ã„ã†ãƒ•ã‚¡ã‚¤ãƒ«ãŒä½œæˆã•ã‚Œã¦ã„ã‚‹ã¨æ€ã„ã¾ã™ãŒã€ãã“ã‚’è¦‹ã‚Œã°vue-routerã‚’ä½¿ã£ãŸã“ã¨ã‚ã‚‹äººã¯ç†è§£ã§ãã‚‹ã¯ãšã§ã™ã€‚


ã¨ã‚Šã‚ãˆãšä¸è¦ãªpages/index.vueã®ä¸­èº«ã‚’å…¨ã¦å‰Šé™¤ã—ã€
ä»¥ä¸‹ã®ã‚ˆã†ã«ä¿®æ­£ã—ã¾ã™ã€‚
ã‚‚ã¡ã‚ã‚“ä»Šã®æ®µéšã§ã¯ãã‚“ãªãƒ•ã‚¡ã‚¤ãƒ«ã¯è¦‹ã¤ã‹ã‚‰ãªã„ã‚ˆã¨è¨€ã‚ã‚Œã¾ã™ãŒä¸€æ—¦ã‚¹ãƒ«ãƒ¼ã§ã€‚


```pages/index.vue
<template>
  <div>
    <AddTodo />
    <TodoList />
  </div>
</template>

<script>
import AddTodo from "@/components/AddTodo";
import TodoList from "@/components/TodoList";

export default {
  components: {
    AddTodo,
    TodoList,
  },
  data() {
    return {
      todos: [],
    };
  },
};
</script>

<style>
</style>
```


## AddTodoã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¨TodoListã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ä½œæˆ

componentsãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªé…ä¸‹ã«AddTodo.vueã¨TodoList.vueã¨ã„ã†ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã™ã€‚
ã‚ã¨pages/inspire.vue, components/Logo.vue, components/VutifyLogo.vueã¯ä¸è¦ãªã®ã§å‰Šé™¤ã—ã¨ãã¾ã™ã€‚

https://vuetifyjs.com/en/components/forms#forms
ã‚’å‚è€ƒã«

```components/AddTodo.vue
<template>
  <v-form>
    <v-container>
      <v-row>
        <v-col cols="12" md="4">
          <v-text-field
            v-model="title"
            :counter="10"
            label="todo"
            required
          ></v-text-field>
        </v-col>
        <v-col cols="12" md="4">
          <v-btn @click="handleSubmit">ä½œæˆ</v-btn>
        </v-col>
      </v-row>
    </v-container>
  </v-form>
</template>

<script>
export default {
  data() {
    return {
      title: "",
    };
  },
  methods: {
    handleSubmit() {
      this.title = "";
    },
  },
};
</script>

<style>
</style>

```

https://vuetifyjs.com/ja/components/data-tables#search
ã‚’å‚è€ƒã«

```components/TodoList.vue
<template>
  <v-card>
    <v-card-title>
      Todo List
      <v-spacer></v-spacer>
      <v-text-field
        v-model="search"
        append-icon="search"
        label="Search"
        single-line
        hide-details
      ></v-text-field>
    </v-card-title>
    <v-data-table
      :headers="headers"
      :items="todos"
      :search="search"
    ></v-data-table>
  </v-card>
</template>

<script>
export default {
  data() {
    return {
      todos: [
        {
          title: "test",
          username: "å¤ªéƒ",
        },
      ],
      search: "",
      headers: [
        {
          text: "ã‚¿ã‚¤ãƒˆãƒ«",
          align: "left",
          sortable: false,
          value: "title",
        },
        { text: "ãƒ¦ãƒ¼ã‚¶ãƒ¼å", value: "username" },
      ],
    };
  },
};
</script>

<style>
</style>
```


## <è¿½è¨˜>searchã‚¢ã‚¤ã‚³ãƒ³ãŒè¡¨ç¤ºã•ã‚Œãªã„å ´åˆ

```
web $ npm install material-design-icons-iconfont
```

plugins/vuetify.jsã‚’ä½œæˆã—ã¦ä»¥ä¸‹ã®ã‚ˆã†ã«è¨˜è¿°ã—ã¾ã—ã‚‡ã†ã€‚

```javascript:plugins/vuetify.js
import 'material-design-icons-iconfont/dist/material-design-icons.css'
import Vue from 'vue'
import Vuetify from 'vuetify/lib'

Vue.use(Vuetify)

export default new Vuetify({
  icons: {
    iconfont: 'md',
  },
})

```

ä½œæˆã—ãŸãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’nuxt.config.jsã®pluginsã«è¿½åŠ ã—ã¾ã™ã€‚


```javascript:nuxt.config.js
  plugins: [
    "@/plugins/vuetify", //è¿½åŠ 
  ],

```
ã‚µãƒ¼ãƒãƒ¼ã‚’ç«‹ã¡ä¸Šã’ç›´ã›ã°ã€searchã‚¢ã‚¤ã‚³ãƒ³ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã¯ãšã§ã™ã€‚


## AddTodoã§ä½œæˆã—ãŸTodoã‚’è¦ªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«ä¼é”ã—ã¦TodoListã§è¡¨ç¤ºã™ã‚‹
ã¾ãšä»¥ä¸‹ã®ã‚ˆã†ã«ã—ã¦AddTodoã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‹ã‚‰è¦ªã®pages/index.vueã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«**$emit**ã§æ¸¡ã—ã¾ã™ã€‚


```js:components/AddTodo.vue
 methods: {
    handleSubmit() {
      this.$emit("submit", this.title);  //ã“ã®è¡Œã‚’è¿½åŠ 
      this.title = "";
    },
  }
```

**$emit**ã§æ¸¡ã£ã¦ããŸã‚‚ã®ã‚’å—ã‘å–ã‚Šã€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå†…ã®todosã¨ã„ã†é…åˆ—ã«pushã—ã¦**TodoListã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ**ã«æ¸¡ã—ã¾ã™ã€‚


```pages/index.vue
<template>
  <div>
    <AddTodo @submit="addTodo" />
    <TodoList :todos="todos" />
  </div>
</template>

<script>
import AddTodo from "@/components/AddTodo";
import TodoList from "@/components/TodoList";

export default {
  components: {
    AddTodo,
    TodoList,
  },
  data() {
    return {
      todos: [],
    };
  },
  methods: {
    addTodo(title) {
      this.todos.push({
        title // title: titleã¨åŒç¾©
      });
    },
  },
};
</script>

<style>
</style>
```


æ¬¡ã«TodoListã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§åˆæœŸå€¤ã§å…¥ã‚Œã¦ã„ãŸtodosã‚’**props**ã§å—ã‘å–ã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

```components/TodoList.vue
<template>
  <v-card>
    <v-card-title>
      Todo List
      <v-spacer></v-spacer>
      <v-text-field
        v-model="search"
        append-icon="search"
        label="Search"
        single-line
        hide-details
      ></v-text-field>
    </v-card-title>
    <v-data-table
      :headers="headers"
      :items="todos"
      :search="search"
    ></v-data-table>
  </v-card>
</template>

<script>
export default {
  props: ["todos"], // <- ã“ã‚Œï¼
  data() {
    return {
      search: "",
      headers: [
        {
          text: "ã‚¿ã‚¤ãƒˆãƒ«",
          align: "left",
          sortable: false,
          value: "title",
        },
        { text: "ãƒ¦ãƒ¼ã‚¶ãƒ¼å", value: "username" },
        // ã“ã“ã®todosã¯propsã§å—ã‘å–ã‚‹ã®ã§å‰Šé™¤ã—ã¾ã™
      ],
    };
  },
};
</script>

<style>
</style>
```


ã“ã“ã¾ã§ã§ã¨ã‚Šã‚ãˆãšVue.jsã§Todo Appã£ã½ã„ã‚‚ã®ã¯ã§ãã¾ã—ãŸãŒã€
**ãƒªãƒ­ãƒ¼ãƒ‰ã™ã‚‹ã¨æ¶ˆãˆã¦ã—ã¾ã„ã¾ã™**
ä»Šå›ã¯ãƒªãƒ­ãƒ¼ãƒ‰ã—ã¦ã‚‚å¤§ä¸ˆå¤«ãªã‚ˆã†ã«ã€DBã‹ã‚‰å‚ç…§ã™ã‚‹ã‚ˆã†ã«ã—ãŸã„ã¨æ€ã„ã¾ã™ã€‚
ãã®ãŸã‚Railsã®APIã«æŠ•ã’ã¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ã”ã¨ã«ãƒ‡ãƒ¼ã‚¿ã‚’ä¿æŒã—ã¦ãŠããŸã„ã§ã™ã€‚
ãƒ¦ãƒ¼ã‚¶ãƒ¼ã”ã¨ã«ãƒ‡ãƒ¼ã‚¿ã‚’ä¿æŒã™ã‚‹ã«ã¯èªè¨¼æ©Ÿèƒ½ãŒå¿…è¦ã«ãªã‚Šã¾ã™ã®ã§ã€å…ˆã«ãƒ­ã‚°ã‚¤ãƒ³æ©Ÿèƒ½ã®å®Ÿè£…ã‹ã‚‰å…¥ã‚ŠãŸã„ã¨æ€ã„ã¾ã™ã€‚
ä»Šå›ã¯ãƒ­ã‚°ã‚¤ãƒ³æ©Ÿèƒ½ã«**Firebase Authentication**ã‚’åˆ©ç”¨ã—ã¾ã™ã€‚

# Firebaseãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä½œæˆ

https://firebase.google.com/?hl=ja
æ–°ã—ã„Firebaseãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä½œæˆã‚’ã—ã¾ã™ã€‚
ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåã‚’å…¥åŠ›ã—ã€ã‚¢ãƒŠãƒªãƒ†ã‚£ã‚¯ã‚¹ã¯ä½¿ã‚ãªã®ã§ä»Šå›ã¯ã‚ªãƒ•ã§å•é¡Œã‚ã‚Šã¾ã›ã‚“ã€‚

## ãƒ­ã‚°ã‚¤ãƒ³æ–¹æ³•ã®è¿½åŠ 

Authentication -> ãƒ­ã‚°ã‚¤ãƒ³æ–¹æ³• -> ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹/ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚


<img width="1406" alt="ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ 2020-01-03 1.12.32.png" src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/251768/fdef2ff2-7892-938b-d7a0-060584ea17cf.png">


## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«ã‚¢ãƒ—ãƒªã‚’è¿½åŠ ã™ã‚‹
<img width="1374" alt="ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ 2020-01-03 1.14.39.png" src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/251768/5e8f1ed9-ecca-2c01-caa2-4306cd16c2f0.png">
<img width="943" alt="ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ 2020-01-03 1.16.56.png" src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/251768/78bdf282-5ceb-26f5-7855-851908ab0cc1.png">


2ã®Firebase SDKã®è¿½åŠ ã¯ä»Šå›é£›ã°ã—ã¦å¤§ä¸ˆå¤«ã§ã™ã€‚

<img width="888" alt="ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ 2020-01-03 1.21.32.png" src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/251768/9bae4b0e-303f-9a11-77d4-02cfbd683d9e.png">

ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹æ™‚ã«Firebaseã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ã†ã®ã§
ä¸€å¿œ**Firebase CLI**ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ãŠãã¾ã—ã‚‡ã†ã€‚(ã©ã“ã§æ‰“ã£ã¦ã‚‚å•é¡Œã‚ã‚Šã¾ã›ã‚“)

```terminal
web $ npm install -g firebase-tools
```

4ã®**Firebase Hosting**ã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤ã‚‚ã™ã£é£›ã°ã—ã¦å¤§ä¸ˆå¤«ã§ã™ã€‚



## Nuxtã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¨Firebaseãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ç´ä»˜ã‘ã‚‹

<img width="1066" alt="ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ 2020-01-03 1.24.52.png" src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/251768/ed25b0d1-4f2a-54a6-67cf-b890fd4d948f.png">

ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨è¨­å®šã‚¢ã‚¤ã‚³ãƒ³ï¼ˆæ­¯è»Šã‚¢ã‚¤ã‚³ãƒ³ï¼‰ãŒã‚ã‚‹ã®ã§ãã¡ã‚‰ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨
ã‚¢ãƒ—ãƒªã®è©³ç´°ç”»é¢ã«ã„ã‘ã¾ã™ã€‚

ä¸‹ã®æ–¹ã«ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã—ã¦ã„ãã¨**Firebase SDK Snippet**ã¨ã„ã†æ¬„ãŒã‚ã‚‹ã®ã§ã€
ãã‚Œã®æ§‹æˆã¨ã„ã†æ¬„ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚ã™ã‚‹ã¨ä»¥ä¸‹ã®ã‚ˆã†ãªAPI_KEYãªã©ãŒå‡ºã¦ãã¾ã™ã®ã§ã€ã‚ã¨ã§ä½¿ã†ã®ã§ã“ã‚Œã‚‰ã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ãŠãã¾ã™ã€‚
<img width="695" alt="ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ 2020-01-03 1.35.04.png" src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/251768/d94d52b4-bb07-3a85-5ba7-4d7ac042594d.png">


Nuxtã§firebaseãŒä½¿ãˆã‚‹ã‚ˆã†ã«firebaseãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’å…¥ã‚Œã¦ãŠãã€‚

```terminal
web $ npm install firebase
```
Nuxtã®**pluginsãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª**ã«
**firebase.js**ã¨ã„ã†æ–°è¦ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œã‚Šã¾ã™ã€‚

```plugins/firebase.js
import firebase from "firebase/app"
import "firebase/auth"

const fbConfig = {
    apiKey: process.env.API_KEY,
    authDomain: process.env.AUTH_DOMAIN,
    projectId: process.env.PROJECT_ID,
};
firebase.initializeApp(fbConfig)

export default firebase
```

ã“ã“ã§ã¯process.env.API_KEYã¨ã—ã¦ã„ã¾ã™ãŒã€
ã“ã‚Œã¯ç’°å¢ƒå¤‰æ•°ã‚’ç”¨ã„ã¦ã„ã¾ã™ã€‚
GitHubã«API_KEYãªã©ã‚’ãã®ã¾ã¾ã‚ã’ã‚‹ã¨æ‚ªç”¨ã•ã‚Œã¦ã—ã¾ã†å¯èƒ½æ€§ãŒã‚ã‚‹ã®ã§ã€ç’°å¢ƒå¤‰æ•°ã‚’ç”¨ã„ã¦gitç®¡ç†ã‹ã‚‰å¤–ã™ã‚ˆã†ã«ã—ãŸã„ã¨æ€ã„ã¾ã™ã€‚


## @nuxtjs/dotenvã®å°å…¥

nuxtã§ç’°å¢ƒå¤‰æ•°ã‚’æ‰±ãˆã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã‚ã‚‹[@nuxtjs/dotenv](https://github.com/nuxt-community/dotenv-module)ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚

```terminal
web $ npm install --save-dev @nuxtjs/dotenv
web $ touch .env
```


nuxt.config.jsã®buildModulesæ¬„ã«@nuxtjs/dotenvã‚’è¿½è¨˜ã—ã¾ã—ã‚‡ã†ã€‚

```nuxt.config.js
  buildModules: [
    '@nuxtjs/vuetify',
    '@nuxtjs/dotenv', // è¿½åŠ 
  ],
```

ä½œæˆã—ãŸ.envãƒ•ã‚¡ã‚¤ãƒ«ã«å…ˆã»ã©ã‚³ãƒ”ãƒ¼ã—ãŸAPI_KEYãªã©ã‚’ç’°å¢ƒå¤‰æ•°ã¨ã—ã¦ç™»éŒ²ã—ã¾ã™ã€‚


```/.env
API_KEY="Aâ—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹k"
AUTH_DOMAIN="â—‹â—‹â—‹â—‹â—‹â—‹"
PROJECT_ID="â—‹â—‹â—‹â—‹â—‹â—‹"
```
ä»Šå›ã¯èªè¨¼ã«ã—ã‹Firebaseã‚’ä½¿ã‚ãªã„ã®ã§è¨˜è¼‰ã™ã‚‹ã®ã¯ä¸Šä¸‰ã¤ã ã‘ã§å•é¡Œãªã„ã§ã™ãŒã€
ä¸€å¿œå…¨ã¦ç™»éŒ²ã—ã¦ãŠãã¾ã™ã€‚



å¿˜ã‚Œãªã„ã†ã¡ã«.gitignoreã«.envã‚’è¿½åŠ ã—ã¦Gitç®¡ç†ä¸‹ã‹ã‚‰é™¤å¤–ã—ã¦ãŠãã¾ã—ã‚‡ã†ã€‚

```/.gitignore
.env
```


```nuxt.config.js
require('dotenv').config(); // <- è¿½åŠ 
export default {
  mode: 'spa',
  ...
```

ã“ã‚Œã§è¨­å®šã¯å®Œäº†ãªã®ã§ã™ãŒã€Nuxtå†…ã§å®Ÿéš›ã«Firebaseã®API_KEYãŒèª­ã¿å–ã‚Œã¦ã„ã‚‹ã‹ä¸€å¿œç¢ºèªã—ã¦ãŠãã¾ã—ã‚‡ã†ã€‚

```pages/index.vue
<template>
  <div>
    <AddTodo @submit="addTodo" />
    <TodoList :todos="todos" />
  </div>
</template>

<script>
import AddTodo from "@/components/AddTodo";
import TodoList from "@/components/TodoList";

export default {
  components: {
    AddTodo,
    TodoList
  },
  created() {
     console.log("API_KEY:", process.env.API_KEY);  //<= ã“ã‚Œè¿½åŠ 
  },
  data() {
    return {
      todos: []
    };
  },
  methods: {
    addTodo(title) {
      this.todos.push({
        title
      });
    }
  }
};
</script>

<style>
</style>
```

ãƒ‡ã‚£ãƒ™ãƒ­ãƒƒãƒ‘ãƒ¼ãƒ„ãƒ¼ãƒ«ã®consoleã§ä»¥ä¸‹ã®ã‚ˆã†ã«è‡ªåˆ†ã®API_KEYãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚Œã°å®Œç’§ã§ã™ï¼ï¼

<img width="545" alt="ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ 2020-01-03 1.56.19.png" src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/251768/dde09b86-9680-b992-f0fc-409e0f484d94.png">




## æ–°è¦ç™»éŒ²ã‚’ã—ãŸã‚‰Firebase Authenticationã«ç™»éŒ²ã•ã‚Œã‚‹ã‚ˆã†ã«ã™ã‚‹
https://firebase.google.com/docs/auth/web/password-auth?hl=ja
firebase SDKãŒæä¾›ã—ã¦ãã‚Œã¦ã„ã‚‹

```javascript
firebase.auth().createUserWithEmailAndPassword
```

ã‚’ä½¿ã„ã¾ã™ã€‚


pagesãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªé…ä¸‹ã«signup.vueã¨ã„ã†ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã™ã€‚

```pages/signup.vue
<template>
  <v-row>
    <v-col cols="12" md="4">
      <h2>Sign Up</h2>
      <form>
        <v-text-field
          v-model="name"
          :counter="10"
          label="Name"
          data-vv-name="name"
          required
        ></v-text-field>
        <v-text-field
          v-model="email"
          :counter="20"
          label="Email"
          data-vv-name="email"
          required
        ></v-text-field>
        <v-text-field
          v-model="password"
          label="password"
          data-vv-name="password"
          required
          :type="show1 ? 'text' : 'password'"
          :append-icon="show1 ? 'mdi-eye' : 'mdi-eye-off'"
          @click:append="show1 = !show1"
        ></v-text-field>
        <v-text-field
          v-model="passwordConfirm"
          label="passwordConfirm"
          data-vv-name="passwordConfirm"
          required
          :type="show2 ? 'text' : 'password'"
          :append-icon="show2 ? 'mdi-eye' : 'mdi-eye-off'"
          @click:append="show2 = !show2"
        ></v-text-field>
        <v-btn class="mr-4" @click="signup">submit</v-btn>
        <p v-if="error" class="errors">{{ error }}</p>
      </form>
    </v-col>
  </v-row>
</template>
<script>
import firebase from "@/plugins/firebase";
export default {
  data() {
    return {
      email: "",
      name: "",
      password: "",
      passwordConfirm: "",
      show1: false,
      show2: false,
      error: "",
    };
  },
  methods: {
    async signup() {
      if (this.password !== this.passwordConfirm) {
        this.error = "â€»ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ç¢ºèªãŒä¸€è‡´ã—ã¦ã„ã¾ã›ã‚“";
      }

      const res = await firebase
        .auth()
        .createUserWithEmailAndPassword(this.email, this.password)
        .catch((error) => {
          this.error = ((code) => {
            switch (code) {
              case "auth/email-already-in-use":
                return "æ—¢ã«ãã®ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¯ä½¿ã‚ã‚Œã¦ã„ã¾ã™";
              case "auth/wrong-password":
                return "â€»ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“";
              case "auth/weak-password":
                return "â€»ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯æœ€ä½6æ–‡å­—ä»¥ä¸Šã«ã—ã¦ãã ã•ã„";
              default:
                return "â€»ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ã”ç¢ºèªãã ã•ã„";
            }
          })(error.code);
        });
    },
  },
};
</script>

<style scoped>
.errors {
  color: red;
  margin-top: 20px;
}
</style>
```


è©¦ã—ã«ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’æ–°è¦ç™»éŒ²ã—ã¦ã¿ã¾ã™ã€‚

<img width="1107" alt="ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ 2020-01-03 4.39.41.png" src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/251768/08dfef65-89b6-3bf7-a816-4e33286dadec.png">


Firebaseã®Consoleã§æ­£ã—ããƒ¦ãƒ¼ã‚¶ãƒ¼ãŒç™»éŒ²ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¾ã—ã‚‡ã†ã€‚
<img width="1386" alt="ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ 2020-01-03 4.37.50.png" src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/251768/e989b7d0-43fc-42f4-7c56-22da5cd47f7c.png">


## Railså´ã«ã‚‚ç™»éŒ²ã™ã‚‹
axiosã‚’ä½¿ã£ã¦POSTãƒ¡ã‚½ãƒƒãƒ‰ã§Railsã®APIã‚’å©ã„ã¦DBã«ã‚‚ä¿å­˜ã—ã¦ã„ãã¾ã™ã€‚

## axiosã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®š
ãã®å‰ã«axiosã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®šã‚’ã—ã¦ã„ãã¾ã™ã€‚
pluginsãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«axios.jsã‚’ä½œæˆã—ã¾ã™ã€‚


```plugins/axios.js
import axios from "axios";

export default axios.create({
    baseURL: process.env.API_ENDPOINT
})

```
ç’°å¢ƒå¤‰æ•°API_ENDPOINTã‚’.envã«è¿½åŠ 

```/.env
//çœç•¥
API_ENDPOINT="http://localhost:3000" // <= è¿½åŠ 
```

nuxt.config.jsãŒé–¢é€£ã—ã¦ãã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç·¨é›†ã—ãŸã®ã§ã‚µãƒ¼ãƒãƒ¼ã‚’ç«‹ã¡ä¸Šã’ç›´ã—ã¾ã™ã€‚

```terminal
web $ npm run dev
```

ã“ã‚Œã§**axios**ã®è¨­å®šã¯okã§ã™ã€‚
ä¸Šã®ã‚ˆã†ãªè¨˜è¿°ã‚’ã™ã‚‹ã“ã¨ã§

```javascript

 axios.post("http::/localhost:3000/v1/users", newUser)
```
ãŒä»¥ä¸‹ã®ã‚ˆã†ã«æ›¸ã‘ã¾ã™ã€‚

```javascript

 axios.post("/v1/users", newUser)
```

ã“ã®ã‚ˆã†ã«ã™ã‚‹ã“ã¨ã§APIå´ãŒãƒ‡ãƒ—ãƒ­ã‚¤å¾Œã«localhostã‹ã‚‰æœ¬ç•ªã®urlãŒå¤‰ã‚ã£ã¦ã‚‚
.envã«è¨˜è¼‰ã®ç’°å¢ƒå¤‰æ•°ã®å€¤ã‚’å¤‰æ›´ã™ã‚‹ã ã‘ã§è‰¯ããªã‚Šã¾ã™ã€‚


## signup.vueã®ä¿®æ­£

```javascript:pages/signup.vue
<script>
import axios from "@/plugins/axios" //è¿½åŠ 

//çœç•¥

  // â†“è¿½åŠ 
  const user = {
    email: res.user.email,
    name: this.name,
    uid: res.user.uid,
  };
  await axios.post("/v1/users", { user }).catch((err) => {
    console.log({ err });
  });
  this.$router.push("/");
```
ä¸Šè¨˜ã®ã‚ˆã†ã«ä¿®æ­£ã—ã¦ã‚‚ã†ä¸€åº¦æ–°è¦ç™»éŒ²ã‚’ã—ã¦ã¿ã¾ã™ã€‚
ã™ã‚‹ã¨ä»¥ä¸‹ã®ã‚ˆã†ãªã‚¨ãƒ©ãƒ¼ãŒèµ·ãã‚‹ã¯ãšã§ã™ã€‚

<img width="1264" alt="ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ 2020-01-03 5.08.54.png" src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/251768/e36ded79-b858-8a91-19c2-cb9057d8e32b.png">

ã“ã‚Œã¯ã¾ã Railsã®APIå´ã§**CORS**ã®è¨­å®šã‚’ã—ã¦ã„ãªã„ã‹ã‚‰ã§ã™ã€‚Railsã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ç•°ãªã‚‹ã‚ªãƒªã‚¸ãƒ³ã‹ã‚‰ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¿è­·ã®ãŸã‚ã«æ‹’å¦ã—ã¾ã™ã€‚ãªã®ã§localhost:8080(Nuxtã®ã‚ªãƒªã‚¸ãƒ³ï¼‰ã‹ã‚‰ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ã¿è¨±å¯ã—ã¦ã‚ã’ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

# CORSã«ã‚ˆã‚‹é€šä¿¡
Railsã§CORSã‚’è¨±å¯ã™ã‚‹ãŸã‚ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã‚ã‚‹**rack-corsã¨**ã„ã†Gemã‚’å…¥ã‚Œã¾ã™ã€‚

```Gemfile.rb
# gem 'rack-cors' <= ã“ã„ã¤ã‚’ã‚¢ãƒ³ã‚³ãƒ¡ãƒ³ãƒˆã—ã¾ã™ã€‚
gem 'rack-cors'
```

```terminal
api $ bundle install
```

rails new --apiã—ãŸæ®µéšã§config/initializers/cors.rbã¨ã„ã†ãƒ•ã‚¡ã‚¤ãƒ«ãŒä½œæˆã•ã‚Œã¦ã„ã‚‹ã¯ãšãªã®ã§ã€ã“ã‚Œã‚’ç·¨é›†ã—ã¦ã„ãã¾ã™ã€‚

```config/initializers/cors.rb
# Be sure to restart your server when you modify this file.

# Avoid CORS issues when API is called from the frontend app.
# Handle Cross-Origin Resource Sharing (CORS) in order to accept cross-origin AJAX requests.

# Read more: https://github.com/cyu/rack-cors

# Rails.application.config.middleware.insert_before 0, Rack::Cors do
#   allow do
#     origins 'example.com'
#
#     resource '*',
#       headers: :any,
#       methods: [:get, :post, :put, :patch, :delete, :options, :head]
#   end
# end
```

ã“ã‚Œã‚’ã“ã†ï¼

```config/initializers/cors.rb

Rails.application.config.middleware.insert_before 0, Rack::Cors do
  allow do
    origins '*' ## <= ä¿®æ­£ã€‚* ã§ãƒ•ãƒ«ã‚ªãƒ¼ãƒ—ãƒ³ã«ã™ã‚‹ã€‚

    resource '*',
      headers: :any,
      methods: [:get, :post, :put, :patch, :delete, :options, :head]
  end
end

```
originsã¨ã„ã†ç®‡æ‰€ã‚’ã‚¢ã‚¹ã‚¿ãƒªã‚¹ã‚¯ã«å¤‰æ›´ã—ã¦ã€ã‚ã‚‰ã‚†ã‚‹ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’è¨±å¯ã—ã¦ã‚ã’ã¾ã™ã€‚
æœ¬æ¥ãªã‚‰*ã§å…¨è¨±å¯ã™ã‚‹ã®ã¯è‰¯ããªã„ã§ã™ãŒã€ä¸€æ—¦ã“ã‚Œã§é€²ã¿ã¾ã™ã€‚
ã‚‚ã†ä¸€åº¦æ–°è¦ç™»éŒ²ã‚’ã—ã¦ã¿ã‚‹ã¨Railså´ã®ãƒ­ã‚°ãŒã¡ã‚ƒã‚“ã¨èµ°ã‚Šã€ä¸Šæ‰‹ãDBã«ä¿å­˜ã•ã‚Œã‚‹ã¯ãšã§ã™ã€‚

<img width="773" alt="ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ 2020-01-03 5.31.12.png" src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/251768/e311aff4-9c3e-7af9-3139-939b0be4b068.png">


é€ã‚‰ã‚Œã¦ãã‚‹parameterã¯ã“ã‚“ãªæ„Ÿã˜ã«ãªã£ã¦ã‚‹ã¯ãšã§ã™ã€‚

```
 Parameters: {"user"=>{"email"=>"qiita@gmail.com", "name"=>"qiita", "uid"=>"DZvDfuxQZCVZKelGwsAqxNtLeFf2"}}
```
ã“ã“ã§ä¸Šæ‰‹ãuserã¨ã„ã†ã‚­ãƒ¼ã§ãƒ©ãƒƒãƒ—ã•ã‚Œã¦ã„ã‚‹ã®ã¯

```javascript

 axios.post("/v1/users", { user })
```
{ user }ã§é€ã£ã¦ã„ã‚‹ã®ãŒãƒã‚¤ãƒ³ãƒˆã§ã€æ™®é€šã«userã§æ¸¡ã™ã¨parameterã®ãƒˆãƒƒãƒ—éšå±¤ã«ã‚‚emailãªã©ãŒæ¥ã¦ã—ã¾ã„ã¾ã™ã€‚
ä»¥ä¸‹ã®ç”»åƒã®ã‚ˆã†ã«å¤‰æ•°ã‚’{}ã§å›²ã‚€ã¨ãã®å¤‰æ•°åãŒã‚­ãƒ¼ã«ãªã£ã¦æ–°ã—ã„ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ç”Ÿæˆã—ã¦ãã‚Œã‚‹ã®ã§
ãã‚Œã‚’ä¸Šæ‰‹ãä½¿ã£ã¦ã¾ã™ã€‚
<img width="589" alt="ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ 2020-01-03 5.36.09.png" src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/251768/3a1c7efd-3d82-952f-7e7c-29a20bb80e5a.png">



# ãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ…‹ã®ä¿æŒ
æ™®æ®µRailsã§ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½œã£ã¦ã‚‹äººã¯deviseãŒæä¾›ã—ã¦ãã‚Œã‚‹ãƒ˜ãƒ«ãƒ‘ãƒ¼ãƒ¡ã‚½ãƒƒãƒ‰ã§ã‚ã‚‹current_userã‚’è‰¯ãä½¿ã†ã¨æ€ã„ã¾ã™ã€‚
Nuxtã§ã‚‚current_userã®ã‚ˆã†ã«ä»Šãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã„ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æƒ…å ±ã‚’ã©ã®ãƒšãƒ¼ã‚¸ã‹ã‚‰ã§ã‚‚å‘¼ã³å‡ºã›ã‚‹ã‚ˆã†ã«ã—ãŸã„ã§ã™ã€‚
Firebaseã§ä»Šãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã„ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æƒ…å ±ã‚’å‘¼ã³å‡ºã™ã«ã¯
[firebase.auth().onAuthStateChanged](https://firebase.google.com/docs/auth/web/start?hl=ja#set_an_authentication_state_observer_and_get_user_data)ã‚’ä½¿ã„ã¾ã™ã€‚
ã¾ãŸã€ä»Šå›ãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ…‹ã¯Vuexã«ä¿æŒã•ã›ã¾ã™ã€‚


pluginsãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªé…ä¸‹ã«authCheck.jsã¨ã„ã†æ–°ã—ã„ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã™ã€‚

```plugins/authCheck.js
import firebase from "@/plugins/firebase";
import axios from "@/plugins/axios";

const authCheck = ({ store, redirect }) => {
  firebase.auth().onAuthStateChanged(async user => {
    if (user) {
      const { data } = await axios.get('/v1/users', {
        params: {
          uid: user.uid,
        },
      });
      console.log("ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã„ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼:", data);
    };
  });
};

export default authCheck;

```

ãŸã é›£ã—ã„ã®ãŒVuexã®storeã¯**props**ã¨åŒæ§˜ã«**ãƒªãƒ­ãƒ¼ãƒ‰ã™ã‚‹ã¨å£Šã‚Œã¾ã™**
ä»–ã«ã‚‚[vuex-persistedstate](https://github.com/robinvdvleuten/vuex-persistedstate)ã¨ã„ã†ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¨sessionStorageã‚’ä½µç”¨ã™ã‚‹ã¨ã„ã†ã‚„ã‚Šæ–¹ãŒã‚ã‚Šã¾ã™ãŒã€
ä»Šå›ã¯nuxtã®ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ã‚’ä¸Šæ‰‹ãåˆ©ç”¨ã—ã¦ä¿æŒã™ã‚‹ã‚„ã‚Šæ–¹ã§ã„ãã¾ã™ã€‚

å…ˆã»ã©ä½œæˆã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’nuxt.config.jsã®**plugins**ã¨ã„ã†é …ç›®ã«è¿½åŠ ã™ã‚‹ã¨
ãƒªãƒ­ãƒ¼ãƒ‰ã™ã‚‹åº¦ã«æ¯å›å‘¼ã‚“ã§ãã‚Œã¾ã™ã€‚(**plugins**ã¯ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®æç”»ã‚ˆã‚Šã‚‚ãšã£ã¨å‰ã«å‘¼ã°ã‚Œã¾ã™ï¼‰

```nuxt.config.js
  plugins: [
    "@/plugins/vuetify",
    "@/plugins/authCheck"
  ],
```
nuxt.config.jsã‚’ä¿®æ­£ã—ãŸã®ã§ã‚µãƒ¼ãƒã‚’ç«‹ã¡ä¸Šã’ç›´ã—ã¾ã™ã€‚

```terminal
web$ npm run dev
```


firebase.auth().onAuthStateChangedã§èª­ã¿è¾¼ã‚ã‚‹æƒ…å ±ã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®email,displayName, profileImg,uidãªã®ã§ã€uidã§æ¤œç´¢ã‚’ã‹ã‘ã‚Œã‚‹ã‚ˆã†ã«railsã®apiå´ã‚’ä¿®æ­£ã—ã¦ã„ãã¾ã™ã€‚


```v1/users_controller.rb
  def index
    @users = if params[:uid] 
               User.find_by(uid: params[:uid])
             else 
               User.all // ä»Šå¾Œä½¿ã‚ãªã„ã®ã§å‰Šé™¤ã—ã¦ã‚‚OK
             end

    render json: @users
  end
```

ä»¥ä¸‹ã®ã‚ˆã†ã«consoleã«ãƒ­ã‚°ã‚¤ãƒ³ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã‚Œã°okã§ã™ï¼

<img width="1038" alt="ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ 2020-01-03 6.00.31.png" src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/251768/956678b9-aadc-4fc6-8f72-b6ec4ad12675.png">



## Vuexã§ç®¡ç†
ã•ã¦ã€ã“ã‚Œã‚’å…¨ã¦ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‹ã‚‰è‡ªç”±è‡ªåœ¨ã«å‘¼ã³å‡ºã›ã‚‹ã‚ˆã†ã«ã™ã‚‹ãŸã‚ã«
Vuexã‚’ä½¿ã£ã¦ã„ãã¾ã™ã€‚

storeãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ä¸­ã«auth.jsã¨ã„ã†ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã™ã€‚


```store/auth.js
export const state = () => ({
  currentUser: null
});

export const mutations = {
  setUser(state, payload) {
    state.currentUser = payload
  },
};

export const actions = {};
```


authCheckãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã§vuexã®storeã«å…¥ã‚Œã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

```plugins/authCheck.js
import firebase from "@/plugins/firebase";
import axios from "@/plugins/axios";

const authCheck = ({ store, redirect }) => {
  firebase.auth().onAuthStateChanged(async user => {
    if (user) {
      const { data } = await axios.get('/v1/users', {
        params: {
          uid: user.uid,
        },
      });
      store.commit("auth/setUser", data)
    } else {
      store.commit("auth/setUser", null)
    }
  });
};

export default authCheck;
```
ã“ã®ã‚ˆã†ã«storeã®stateã«Railsã‹ã‚‰å—ã‘å–ã£ãŸãƒ‡ãƒ¼ã‚¿ãŒå…¥ã£ã¦ã„ã‚Œã°å®Œç’§ã§ã™ã€‚
ãƒªãƒ­ãƒ¼ãƒ‰ã—ã¦ã‚‚åŒã˜å€¤ãŒå…¥ã£ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚

<img width="567" alt="ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ 2020-01-03 6.07.04.png" src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/251768/257cb58b-7beb-89d1-aafa-f7a87f5f0f29.png">




## ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå†…ã§ãƒ­ã‚°ã‚¤ãƒ³ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’å‘¼ã³å‡ºã™ã€‚

ã‚¹ãƒˆã‚¢ã«ã‚ã‚‹çŠ¶æ…‹ã‚’ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå†…ã§å¼•ãå‡ºã™ã«ã¯**ç®—å‡ºãƒ—ãƒ­ãƒ‘ãƒ†ã‚£**ã§è¿”ã™ã“ã¨ã§ã™ã€‚
ã¨[vuexã®å…¬å¼](https://vuex.vuejs.org/ja/guide/state.html)ãŒè¨€ã£ã¦ã„ã‚‹ã®ã§ã€ãã‚Œã«å¾“ã„ã¾ã™ã€‚

```javascript

computed: {
  user(){
    return this.$store.state.currentUser
  }
}
```
ã“ã‚Œã§templateå†…ã§ã¯â€user",scriptå†…ã§ã¯"this.user"ã§å‘¼ã³å‡ºã›ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚




è©¦ã—ã«ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã„ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®åå‰ã‚’è¡¨ç¤ºã—ã¦ã¿ã¾ã™ã€‚


```pages/index.vue
<template>
  <div>
    <p>{{user.name}}</p> //<- è¿½åŠ 
    <AddTodo @submit="addTodo" />
    <TodoList :todos="todos" />
  </div>
</template>

<script>
import AddTodo from "@/components/AddTodo";
import TodoList from "@/components/TodoList";

export default {
  components: {
    AddTodo,
    TodoList
  },
  computed: {  //<- è¿½åŠ 
    user() {
      return this.$store.state.auth.currentUser;
    }
  },
  data() {
    return {
      todos: []
    };
  },
  methods: {
    addTodo(title) {
      this.todos.push({
        title
      });
    }
  }
};
</script>

<style>
</style>

```


â€Cannot read property 'name' of null"ã¨ã„ã†ã‚¨ãƒ©ãƒ¼ãŒã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«å‡ºã¦ã‚‹ã¨æ€ã„ã¾ã™ã€‚
ã“ã‚Œã¯firebaseã«ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã„ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’å–ã‚Šã«è¡Œã£ã¦ã€ãã®å¾Œã«railså´ã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’æŠ•ã’ã¦ã„ã‚‹ã®ã§ã€storeã«ãƒ‡ãƒ¼ã‚¿ãŒå…¥ã‚‹å‰ã«ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒæç”»ã•ã‚Œã¦ã„ã‚‹ã‹ã‚‰ã§ã™ã€‚

ã“ã‚Œã«é–¢ã—ã¦ã¯ãŠãã‚‰ãå¤šãã®äººãŒã¶ã¡å½“ãŸã‚‹å•é¡Œã ã¨æ€ã„ã¾ã™ã€‚ã„ãã¤ã‹è§£æ±ºæ–¹æ³•ã¯ã‚ã‚‹ã®ã§ã™ãŒã€ã“ã“ã§è§£èª¬ã™ã‚‹ã¨é•·ããªã£ã¦ã—ã¾ã†ã®ã§v-ifã§ã„ãã¾ã™ã€‚
(1.nameãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’äºˆã‚ç”¨æ„ã—ã¦ãŠãã€2.v-if 3. $store.watch 4. åˆæœŸæç”»ç”»é¢ã‚’ä½œã‚‹)

v-ifã‚’ä½¿ãˆã°storeã®userãŒã‚»ãƒƒãƒˆã•ã‚ŒãŸã‚‰ã€v-ifã§å›²ã£ã¦ã„ã‚‹éƒ¨åˆ†ãŒæç”»ã•ã‚Œã‚‹ã‚ˆã†ã«ãªã‚‹ã®ã§ã€
nameã¨æ›¸ã„ã¦ã„ã‚‹ç®‡æ‰€ã§ã‚¨ãƒ©ãƒ¼ãŒèµ·ãã‚‹ã“ã¨ã¯ç„¡ããªã‚Šã¾ã™ã€‚

```pages/index.vue
<template>
  <div v-if="user">
    <p>{{user.name}}</p>
    <AddTodo @submit="addTodo" />
    <TodoList :todos="todos" />
  </div>
</template>

<script>
import AddTodo from "@/components/AddTodo";
import TodoList from "@/components/TodoList";

export default {
  components: {
    AddTodo,
    TodoList
  },
  computed: {
    user() {
      return this.$store.state.auth.currentUser;
    }
  },
  data() {
    return {
      todos: []
    };
  },
  methods: {
    addTodo(title) {
      this.todos.push({
        title
      });
    }
  }
};
</script>

<style>
</style>
```


##  ãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ã®ä½œæˆ

ãƒ­ã‚°ã‚¤ãƒ³ã«ã¯

```javascript
firebase.auth().signInWithEmailAndPassword
```

ã‚’ä½¿ã„ã¾ã™ã€‚

```pages/login.vue
<template>
  <v-row>
    <v-col cols="12" md="4">
      <h2>Login</h2>
      <form>
        <v-text-field
          v-model="email"
          :counter="20"
          label="email"
          data-vv-name="email"
          required
        ></v-text-field>
        <v-text-field
          v-model="password"
          label="password"
          data-vv-name="password"
          required
          :type="show1 ? 'text' : 'password'"
          :append-icon="show1 ? 'mdi-eye' : 'mdi-eye-off'"
          @click:append="show1 = !show1"
        ></v-text-field>
        <v-btn class="mr-4" @click="login">submit</v-btn>
        <p v-if="error" class="errors">{{ error }}</p>
      </form>
    </v-col>
  </v-row>
</template>

<script>
import firebase from "@/plugins/firebase";
export default {
  data() {
    return {
      email: "",
      password: "",
      show1: false,
      error: "",
    };
  },
  methods: {
    async login() {
      await firebase
        .auth()
        .signInWithEmailAndPassword(this.email, this.password)
        .catch((error) => {
          console.log(error);
          this.error = ((code) => {
            switch (code) {
              case "auth/user-not-found":
                return "ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒé–“é•ã£ã¦ã„ã¾ã™";
              case "auth/wrong-password":
                return "â€»ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“";
              default:
                return "â€»ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ã”ç¢ºèªãã ã•ã„";
            }
          })(error.code);
        });

      this.$router.push("/");
    },
  },
};
</script>

<style scoped>
.errors {
  color: red;
  margin-top: 20px;
}
</style>
```

## ãƒã‚¤ãƒšãƒ¼ã‚¸ã®ä½œæˆ

ã®å‰ã«ãƒšãƒ¼ã‚¸æ•°ãŒå¢—ãˆã¦ããŸã®ã§ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒãƒ¼ã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒªã‚¹ãƒˆã‚’å¤‰ãˆã¦ãŠãã¾ã—ã‚‡ã†ã€‚

```layouts/defaut.vue
<template>
  <v-app dark>
    <v-navigation-drawer v-model="drawer" :mini-variant="miniVariant" :clipped="clipped" fixed app>
      <v-list>
        <v-list-item v-for="(item, i) in items" :key="i" :to="item.to" router exact>
          <v-list-item-action>
            <v-icon>{{ item.icon }}</v-icon>
          </v-list-item-action>
          <v-list-item-content>
            <v-list-item-title v-text="item.title" />
          </v-list-item-content>
        </v-list-item>
      </v-list>
    </v-navigation-drawer>
    <v-app-bar :clipped-left="clipped" fixed app>
      <v-app-bar-nav-icon @click.stop="drawer = !drawer" />
      <v-btn icon @click.stop="miniVariant = !miniVariant">
        <v-icon>mdi-{{ `chevron-${miniVariant ? 'right' : 'left'}` }}</v-icon>
      </v-btn>
      <v-btn icon @click.stop="clipped = !clipped">
        <v-icon>mdi-application</v-icon>
      </v-btn>
      <v-btn icon @click.stop="fixed = !fixed">
        <v-icon>mdi-minus</v-icon>
      </v-btn>
      <v-toolbar-title v-text="title" />
      <v-spacer />
      <v-btn icon @click.stop="rightDrawer = !rightDrawer">
        <v-icon>mdi-menu</v-icon>
      </v-btn>
    </v-app-bar>
    <v-content>
      <v-container>
        <nuxt />
      </v-container>
    </v-content>
    <v-navigation-drawer v-model="rightDrawer" :right="right" temporary fixed>
      <v-list>
        <v-list-item @click.native="right = !right">
          <v-list-item-action>
            <v-icon light>mdi-repeat</v-icon>
          </v-list-item-action>
          <v-list-item-title>Switch drawer (click me)</v-list-item-title>
        </v-list-item>
      </v-list>
    </v-navigation-drawer>
    <v-footer :fixed="fixed" app>
      <span>&copy; 2019</span>
    </v-footer>
  </v-app>
</template>

<script>
export default {
  data() {
    return {
      clipped: false,
      drawer: false,
      fixed: false,
      items: [
        {
          icon: "mdi-apps",
          title: "Todos", //è¿½åŠ 
          to: "/"ã€€//è¿½åŠ 
        },
        {
          icon: "mdi-chart-bubble",
          title: "mypage", //è¿½åŠ 
          to: "/mypage"  //è¿½åŠ 
        }
      ],
      miniVariant: false,
      right: true,
      rightDrawer: false,
      title: "Todo App" //è¿½åŠ 
    };
  },
};
</script>
```


## ãƒã‚¤ãƒšãƒ¼ã‚¸ã®ä½œæˆ

ãƒã‚¤ãƒšãƒ¼ã‚¸ã«ã¯ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæƒ…å ±ã¨ãƒ­ã‚°ã‚¢ã‚¦ãƒˆãƒœã‚¿ãƒ³ã‚’é…ç½®ã—ã¾ã™ã€‚
[Firebaseã®signout](https://firebase.google.com/docs/auth/web/password-auth?hl=ja)
ã«ã¯

```javascript

firebase.auth().signOut()
```
ã‚’ä½¿ã„ã¾ã™ã€‚

pages/mypage.vueã‚’ä½œæˆã—ã¾ã™ã€‚

```pages/mypage.vue
<template>
  <div>
    <div v-if="user">
      <p>Email: {{ user.email }}</p>
      <p>ãƒ¦ãƒ¼ã‚¶ãƒ¼å: {{ user.name }}</p>
    </div>
    <v-btn @click="logOut">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</v-btn>
  </div>
</template>

<script>
import firebase from "@/plugins/firebase";
export default {
  computed: {
    user() {
      return this.$store.state.auth.currentUser;
    },
  },
  methods: {
    async logOut() {
      await firebase
        .auth()
        .signOut()
        .catch((error) => {
          console.log(error);
        });

      this.$store.commit("setUser", null);
      this.$router.push("/login");
    },
  },
};
</script>

<style>
</style>
```


## ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒãƒ¼ã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒªã‚¹ãƒˆã®æ¡ä»¶åˆ†å²
ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã„ã‚‹ã‹ã—ã¦ã„ãªã„ã‹ã§ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒªã‚¹ãƒˆã‚’æ¡ä»¶åˆ†å²ã—ã¾ã™ã€‚

```javascript:layouts/default.vue
 items: [
        {
          icon: "mdi-apps",
          title: "Todos",
          to: "/"
        },
        {
          icon: "mdi-chart-bubble",
          title: "mypage",
          to: "/mypage"
        }
      ],
```

ä¸Šã®dataã®ã¨ã“ã«å…¥ã‚Œã¦ã„ã‚‹itemsãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’å‰Šé™¤ã—ã¦
æ–°ã—ãç®—å‡ºãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’ä½œã‚Šã¾ã™ã€‚


```javascript:layouts/default.vue
computed: {
    user() {
      return this.$store.state.auth.currentUser;
    },
    items() {
      if (this.user) {
        return [
          {
            icon: "mdi-apps",
            title: "Todos",
            to: "/"
          },
          {
            icon: "mdi-chart-bubble",
            title: "mypage",
            to: "/mypage"
          }
        ];
      } else {
        return [
          {
            icon: "mdi-apps",
            title: "ãƒ­ã‚°ã‚¤ãƒ³",
            to: "/login"
          },
          {
            icon: "mdi-chart-bubble",
            title: "æ–°è¦ç™»éŒ²",
            to: "/signup"
          }
        ];
      }
    }
}

```

ã“ã“ã¾ã§ã§ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã„ã‚‹çŠ¶æ…‹ã¨ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã—ã¦ã„ã‚‹çŠ¶æ…‹ã§
ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒãƒ¼ã®itemsãŒå¤‰ã‚ã£ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã§ããŸã‚‰okã§ã™ã€‚


## Railsã®APIã‚’å©ãã¨ã“ã‚ã®ä¿®æ­£


AddTodoã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§å…ˆã»ã©titleã®ã¿ã‚’$emitã§è¦ªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«æ¸¡ã—ã¦ã„ã¾ã—ãŸãŒã€
user_idã‚‚å«ã‚ãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¨ã—ã¦é€ã‚‹ã‚ˆã†ã«å¤‰æ›´ã—ã¾ã™ã€‚

```components/AddTodo.vue
<template>
  <v-form>
    <v-container>
      <v-row>
        <v-col cols="12" md="4">
          <v-text-field
            v-model="title"
            :counter="10"
            label="todo"
            required
          ></v-text-field>
        </v-col>
        <v-col cols="12" md="4">
          <v-btn @click="handleSubmit">ä½œæˆ</v-btn>
        </v-col>
      </v-row>
    </v-container>
  </v-form>
</template>
<script>
export default {
  data() {
    return {
      title: "",
    };
  },
  computed: {
    user() {
      return this.$store.state.auth.currentUser;
    },
  },
 methods: {
    handleSubmit() {
      const todo = {
        title: this.title,
        user_id: this.user.id, // è¿½åŠ 
      };
      this.$emit("submit", todo); 
      this.title = "";
    }
  }
};
</script>

<style>
</style>
```


```pages/index.vue
<template>
  <div v-if="user">
    <p>{{user.name}}</p>
    <AddTodo @submit="addTodo" />
    <TodoList :todos="user.todos" /> //ä¿®æ­£
  </div>
</template>

<script>
import AddTodo from "@/components/AddTodo";
import TodoList from "@/components/TodoList";
import axios from "@/plugins/axios";
export default {
  components: {
    AddTodo,
    TodoList
  },
  computed: {
    user() {
      return this.$store.state.auth.currentUser;
    }
  },
  methods: {
    async addTodo(todo) {
      const { data } = await axios.post("/v1/todos", { todo });
      //è¿½åŠ 
      this.$store.commit("auth/setUser", {
        ...this.user,
        todos: [...this.user.todos, data] 
      });
    }
  }
};
</script>

<style>
</style>
```


## Todoå‰Šé™¤æ©Ÿèƒ½ã®è¿½åŠ 

deleteItemã¨ã„ã†ãƒ¡ã‚½ãƒƒãƒ‰ã‚’è¿½åŠ ã—ã€å¼•æ•°ã§ã‚¯ãƒªãƒƒã‚¯ã—ãŸitem(todo)ã‚’æ¸¡ã—ã¦ã€axios.deleteã§APIã‚’å©ãã«ã„ãã¾ã™ã€‚

```components/TodoList.vue
  <template>
    <v-card>
      <v-card-title>
        Todo List
        <v-spacer></v-spacer>
        <v-text-field
          v-model="search"
          append-icon="search"
          label="Search"
          single-line
          hide-details
        ></v-text-field>
      </v-card-title>
      <v-data-table :headers="headers" :items="todos" :search="search">
        <template v-slot:item.action="{ item }">
          <v-icon small @click="deleteItem(item)">delete</v-icon>
        </template>
      </v-data-table>
    </v-card>
</template>

<script>
import axios from "@/plugins/axios";
export default {
  props: ["todos"],
  data() {
    return {
      singleSelect: true,
      selected: [],
      search: "",
      headers: [
        {
          text: "ã‚¿ã‚¤ãƒˆãƒ«",
          align: "left",
          sortable: false,
          value: "title",
        },
        { text: "ãƒ¦ãƒ¼ã‚¶ãƒ¼å", value: "username" },
        { text: "Actions", value: "action", sortable: false },
      ],
    };
  },
  computed: {
    user() {
      return this.$store.state.auth.currentUser;
    },
  },
  methods: {
    async deleteItem(item) {
      const res = confirm("æœ¬å½“ã«å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ");
      if (res) {
        await axios.delete(`/v1/todos/${item.id}`);
        const todos = this.user.todos.filter((todo) => {
          return todo.id !== item.id;
        });
        const newUser = {
          ...this.user,
          todos,
        };
        this.$store.commit("auth/setUser", newUser);
      }
    },
  },
};
</script>

<style>
</style>
```





ï¼ƒ# ç¾çŠ¶ã®å•é¡Œç‚¹

ç¾çŠ¶ã€æ–°è¦ç™»éŒ²ã‚’ã™ã‚‹ã¨ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒãƒ¼ãŒå¤‰ã‚ã£ã¦ã„ãªã„ã¨æ€ã„ã¾ã™ã€‚
ã“ã‚Œã¯POSTãŒå®Œäº†ã™ã‚‹å‰ã«GETã§ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’å–å¾—ã—ã«è¡Œã£ã¦ã—ã¾ã£ã¦ã„ã‚‹ã“ã¨ãŒåŸå› ã§ã™ã€‚

<img width="626" alt="ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ 2020-01-04 1.27.40.png" src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/251768/c43457ac-df66-6f4d-6109-3432bbee0f41.png">

ã¾ãŸã€ä»Šã®ã¾ã¾ã§ã¯æ–°è¦ç™»éŒ²ãŒã‚ã¾ã‚Šã«ã‚‚ã‚ã£ã•ã‚Šã—ã™ãã¦ã„ã‚‹ã“ã¨ã‚‚ã‚ã‚Šã€
ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã•ã›ã¦POSTãŒçµ‚ã‚ã‚‹ã®ã‚’å¾…ãŸã›ã‚‹ã‚ˆã†ã«ã—ãŸã„ã¨æ€ã„ã¾ã™ã€‚



# Loadingã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ä½œæˆ


ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½œã‚‹ã®ã«[loaders.css](https://connoratherton.com/loaders)ã¨ã„ã†ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ã„ã¾ã™ã€‚


```
web $ npm install loaders.css
```

```javascript:components/Loading.vue
<template>
  <div class="loader-container">
    <div class="loaders">
      <div class="ball-clip-rotate">
        <div class="ball"></div>
      </div>
    </div>
  </div>
</template>

<script>
import "loaders.css";
export default {
};
</script>

<style  lang="scss" scoped>
$theme-color: #25b290;
.loader-container {
  position: fixed;
  top: 0;
  z-index: 999;
  width: 100%;
  height: 100vh;
  background: #eee;
  opacity: 0.7;
}

.ball-clip-rotate > div {
  border: 2px solid $theme-color;
  /* background-color: orange !important; */
  border-bottom-color: transparent !important;
}

.ball-clip-rotate {
  position: absolute;
  top: 50%;
  color: red;
  transform: translate(-50%, -50%);
  left: 50%;
}
</style>

```



ã©ã‚“ãªæ„Ÿã˜ã«ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ãŒèµ·ãã‚‹ã‹default.vueã§è©¦ã—ã«è¡¨ç¤ºã—ã¦ã¿ã¾ã™ã€‚

```javascript:layouts/default.vue
<template>
  <v-app dark>
    <div>
      <Loading></Loading>ã€€ã€€//ã€€è¿½åŠ 
    </div>
ã€€ã€€//çœç•¥
</template>

<script>
import Loading from "@/components/Loading";ã€€//è¿½åŠ 
export default {
 ã€€// çœç•¥
  components: {
    Loadingã€€ã€€//è¿½åŠ 
  },
ã€€//ã€€çœç•¥
};
</script>

```


ä¸‹ã®ç”»åƒã®ã‚ˆã†ã«ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã•ã‚Œã¦ã„ã‚Œã°okã§ã™ã€‚

<img width="1432" alt="ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ 2020-01-04 1.36.58.png" src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/251768/d2719cfb-39cf-bdb9-ffa6-d1d3d3d4d40c.png">



ã§ã¯ã€æ–°è¦ç™»éŒ²ã®æ™‚ã ã‘ã“ã®ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚’å‘¼ã³è¾¼ã‚€ã‚ˆã†ã«storeã§çŠ¶æ…‹ã‚’ä¿æŒã™ã‚‹ã‚ˆã†ã«ã—ã¾ã—ã‚‡ã†ã€‚
æ–°ã—ããƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹ã‚’ç®¡ç†ã™ã‚‹ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãŒå¿…è¦ã«ãªã£ãŸã®ã§
store/loading.jsã¨ã„ã†ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã™ã€‚


```store/loading.js
export const state = () => ({
  isLoading: false
});

export const mutations = {
  setLoading(state, payload) {
    state.isLoading = payload
  }
};

export const actions = {};
```



POSTãŒå®Œäº†ã™ã‚‹ã¾ã§å¾…ã¤ã®ã§ã¯ãªãã€ä»Šå›ã¯signupã®æ™‚ã ã‘POSTã®promiseã§è¿”ã£ã¦ããŸå€¤ã‚’ãã®ã¾ã¾vuexã®storeã«ã¶ã¡è¾¼ã¿ã¾ã™ã€‚

```javascript:pages/signup.vue
 methods: {
    async signup() {
      if (this.password !== this.passwordConfirm) {
        this.error = "â€»ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ç¢ºèªãŒä¸€è‡´ã—ã¦ã„ã¾ã›ã‚“";
        return;
      }
      this.$store.commit("loading/setLoading", true); 
      const res = await firebase
        .auth()
        .createUserWithEmailAndPassword(this.email, this.password)
        .catch((error) => {
          this.error = ((code) => {
            switch (code) {
              case "auth/email-already-in-use":
                return "æ—¢ã«ãã®ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¯ä½¿ã‚ã‚Œã¦ã„ã¾ã™";
              case "auth/wrong-password":
                return "â€»ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“";
              case "auth/weak-password":
                return "â€»ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯æœ€ä½6æ–‡å­—ä»¥ä¸Šã«ã—ã¦ãã ã•ã„";
              default:
                return "â€»ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ã”ç¢ºèªãã ã•ã„";
            }
          })(error.code);
        });

      const user = {
        email: res.user.email,
        name: this.name,
        uid: res.user.uid,
      };
      const { data } = await axios.post("/v1/users", { user }).catch((err) => {
        console.log({ err });
      });

      this.$store.commit("loading/setLoading", false); 
      this.$store.commit("auth/setUser", data);
      this.$router.push("/");
    },
  },
```



```components/Loading.vue
<template>
  <div class="loader-container" v-if="loading"> // v-ifã§æ¡ä»¶åˆ†å²
    <div class="loaders">
      <div class="ball-clip-rotate">
        <div class="ball"></div>
      </div>
    </div>
  </div>
</template>

<script>
import "loaders.css";
export default {
  computed: {
    loading() {
      return this.$store.state.loading.isLoading;ã€€//storeã‹ã‚‰èª­ã¿è¾¼ã‚€
    }
  }
};
</script>
```
ã“ã‚Œã§vuexã®loadingã‚¹ãƒ†ãƒ¼ãƒˆãŒtrueã®æ™‚ã ã‘ãã‚‹ãã‚‹ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ãŒèµ·ã“ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚
SPAã¯ã‚µã‚¯ã‚µã‚¯å‹•ãã®ãŒãƒ¡ãƒªãƒƒãƒˆã§ã¯ã‚ã‚Šã¾ã™ãŒã€ä¾‹ãˆã°æ±ºæ¸ˆã‚„ç”»åƒèªè­˜ãªã©ã€å‡¦ç†ãŒæ—©ã™ãã‚‹ã¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒä¸å®‰ã«ãªã‚‹ã‚±ãƒ¼ã‚¹ã‚‚ã‚ã‚Šã¾ã™ã€‚
æ™‚ã«ã¯ã‚ãˆã¦ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚’å·®ã—è¾¼ã‚“ã§ã‚ã’ã‚‹ã“ã¨ãŒUXã®é¢ã§ã¯å¤§åˆ‡ã§ã™ã€‚


# Successã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ä½œæˆ
æ–°è¦ç™»éŒ²å¾Œã‚„ãƒ­ã‚°ã‚¤ãƒ³å¾Œã«ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã§ã‚µã‚¯ã‚»ã‚¹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤ºã™ã‚‹ã‚ˆã†ã«ã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼

ã¾ãšã¯ã‚µã‚¯ã‚»ã‚¹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’storeã§ç®¡ç†ã—ãŸã„ã¨æ€ã†ã®ã§notificationã¨ã„ã†ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’è¿½åŠ ã—ã¾ã—ã‚‡ã†ã€‚


```store/notification.js
export const state = () => ({
  message: "",
});

export const mutations = {
  setLoading(state, payload) {
    state.message = payload
  }
};

export const actions = {};
```



Successãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤ºã™ã‚‹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚
```components/messages/Success.vue

<template>
  <transition name="fade">
    <div v-if="notice.message" class="success">{{notice.message}}</div>
  </transition>
</template>


<script>
export default {
  computed: {
    notice() {
      return this.$store.state.notification;
    }
  }
};
</script>

<style scoped>
.success {
  position: fixed;
  top: 0;
  z-index: 50;
  text-align: center;
  line-height: 56px;
  width: 100%;
  background: rgb(193, 245, 193);
  color: #fff;
}
.fade-enter-active,
.fade-leave-active {
  transition: opacity 0.5s;
}
.fade-enter, .fade-leave-to /* .fade-leave-active below version 2.1.8 */ {
  opacity: 0;
}
</style>

```



ä½œæˆã—ãŸSuccessã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’default.vueã«å…¥ã‚Œè¾¼ã¿ã¾ã™ã€‚


```layouts/default.vue
<template>
  <v-app dark>
    <Success /> //è¿½åŠ 
    <Loading /> 

<script>
import Loading from "@/components/Loading";
import Success from "@/components/messages/Success" //è¿½åŠ 
export default {
  //çœç•¥
  components: {
    Loading,
    Success  //è¿½åŠ 
  },
}
```

è©¦ã—ã«[Vue-devtools](https://chrome.google.com/webstore/detail/vuejs-devtools/nhdogjmejiglipccpnnnanhbledajbpd?hl=ja)ã§stateã®å€¤ã‚’å¤‰æ›´ã—ã¦ã¿ã¾ã™

<img width="619" alt="ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ 2020-01-04 3.25.44.png" src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/251768/e3ff1393-4aa5-bc9e-470c-50deb06c7db3.png">


ã™ã‚‹ã¨ä¸‹ã®ç”»åƒã®ã‚ˆã†ã«ä¸Šæ‰‹ãã‚µã‚¯ã‚»ã‚¹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ã¨æ€ã„ã¾ã™ã€‚



<img width="1431" alt="ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ 2020-01-04 3.28.40.png" src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/251768/42ce5967-03b2-b79e-57ba-bde2ca14075b.png">



è©¦ã—ã«loginæ™‚ã«ã‚µã‚¯ã‚»ã‚¹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤ºã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

```javascript:pages/login.vue

login() {
      firebase
        .auth()
        .signInWithEmailAndPassword(this.email, this.password)
        .then(() => {
          this.$store.commit("setNotice", {
            status: true,
            message: "ãƒ­ã‚°ã‚¤ãƒ³ã—ã¾ã—ãŸ"
          });
          setTimeout(() => {
            this.$store.commit("setNotice",{});
          }, 2000); //2ç§’å¾Œã«éš ã™
          this.$router.push("/");
        })
```

ã“ã‚Œã§æ–°è¦ç™»éŒ²æ™‚ã€ãƒ­ã‚°ã‚¢ã‚¦ãƒˆæ™‚ã€Todoä½œæˆæ™‚ã«ã‚‚messageã®å€¤ã‚’å¤‰ãˆã¦$store.commit("setNotice")ã‚’ã™ã‚‹ã ã‘ã§ã‚µã‚¯ã‚»ã‚¹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒå‘¼ã³è¾¼ã‚ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸ



# ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã‚¬ãƒ¼ãƒ‰ã®å®Ÿè£…
railsã®deviseã§è¨€ã†ã¨ã“ã‚ã®authenticate_user!çš„ãªã‚„ã¤ã§ã™ã€‚
ç¾çŠ¶ã€ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã„ãªã„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã§ã‚‚ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸ã‚„ãƒã‚¤ãƒšãƒ¼ã‚¸ã‚’è¦‹ã‚Œã¦ã—ã¾ã„ã¾ã™ã€‚
ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã„ãªã„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã•ã›ã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

Vue.jsã«æ…£ã‚Œã¦ã„ã‚‹äººãªã‚‰**router.beforeEach**ãªã‚“ã‹ã‚’æ€ã„ã¤ãã¨æ€ã„ã¾ã™ãŒã€
ä»Šå›ã¯storeã®å€¤ã‚’å…ƒã«æ¡ä»¶åˆ†å²ã—ã¦ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã‚¬ãƒ¼ãƒ‰ã•ã›ãŸã„ã®ã§Nuxtã®ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ã§ã‚ã‚‹**fetch**ã‚‚ã—ãã¯**middleware**ã‚’ä½¿ã„ã¾ã™ã€‚



storeã®currentUserã¨ã„ã†ã‚­ãƒ¼ã‚’[$store.watch](https://vuex.vuejs.org/ja/api/#watch)ã§ç›£è¦–ã—ã¾ã™ã€‚firebase.auth().onAuthStateChanged()ã§currentUserã®å€¤ãŒæ›¸ãæ›ã‚ã‚‹ã¨$store.watchãŒç™ºç«ã—ã¾ã™ã€‚
å¤‰æ›´å¾Œã®currentUserã®å€¤ãŒnullã§ã‚ã‚Œã°(ã¤ã¾ã‚Šãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã„ãªã‘ã‚Œã°)ã€redirect("/login")ã™ã‚‹ã¨ã„ã†æ„Ÿã˜ã§ã™ã€‚

ï¼Šfetchã‚’ä½¿ã†å ´åˆ

```javascript:pages/index.vue
fetch({ store, redirect }) {
    store.watch(
      state => state.auth.currentUser,
      (newUser, oldUser) => {
        if (!newUser) {
          return redirect("/login");
        }
      }
    );
  },
```


ï¼Šmiddlewareã‚’ä½¿ã†å ´åˆ

```middleware/routerGuard.js
export default function ({
    store,
    redirect,
    route,

}) {
    store.watch(
        state => state.auth.currentUser,
        (newUser, oldUser) => {
            if (!newUser) {
                switch (route.name) {
                    case "index":
                        redirect("/login")
                    case "mypage":
                        redirect("/login")
                    default:
                        return;
                }
            }
        }
    );
}
```


```nuxt.config.js
export default {
  mode: 'spa',
  router: { //è¿½åŠ 
    middleware: ['routerGuard']
  },
```

ä¾‹ã«ã‚ˆã£ã¦ã‚µãƒ¼ãƒã‚’ç«‹ã¡ä¸Šã’ç›´ã—ã¾ã™

```terminal
web $ npm run dev
```

ã©ã¡ã‚‰ã‚’ä½¿ã†ã¹ãã‹ã§ã™ãŒã€middlewareã‚’ä»•è¾¼ã‚€ã¨routeãŒæ¯å›å¤‰ã‚ã‚‹åº¦ã«ã‚³ãƒ¼ãƒ‰ãŒèµ°ã‚‹ã®ã§fetchã®æ–¹ãŒè‰¯ã„ã¨æ€ã„ã¾ã™ã€‚

middlewareã®ç”¨é€”ã§ã™ãŒã€è©³ç´°ãƒšãƒ¼ã‚¸ã§ãƒªãƒ­ãƒ¼ãƒ‰ã•ã‚ŒãŸæ™‚ã«å‰ã®ãƒšãƒ¼ã‚¸ã«å¼·åˆ¶ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã•ã›ã‚‹ãŸã‚ã«middlewareã‚’ä½¿ã„ã¾ã™ã€‚
(ä¸€è¦§ãƒšãƒ¼ã‚¸ã‹ã‚‰propsã§ãƒ‡ãƒ¼ã‚¿ã‚’å—ã‘å–ã£ã¦è¡¨ç¤ºã—ã¦ã„ã‚‹ã¨ã€ãƒªãƒ­ãƒ¼ãƒ‰ã•ã‚ŒãŸã¨ãã«propsãŒæ¶ˆãˆã¦ã—ã¾ã†ã®ã§ï¼‰


ãŸã ç¾çŠ¶ã€currentUserã®åˆæœŸå€¤ãŒnullã«ãªã£ã¦ã„ã‚‹ã®ã§
authStateChangedã®æ¡ä»¶åˆ†å²ã§store.commit("setUser", null)ã¨ã—ã¦ã‚‚ã€å¤‰æ›´ã•ã‚ŒãŸã¨èªè­˜ã§ããš$store.watchãŒç™ºç«ã›ãšã€
ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã•ã‚Œã¾ã›ã‚“ã€‚

ä»¥ä¸‹ã®ã‚ˆã†ã«åˆæœŸå€¤ã‚’ä¿®æ­£ã—ã¾ã™ã€‚


```store/auth.js
export const state = () => ({
  currentUser: {}
});

// çœç•¥
```

ã“ã‚Œã«ã‚ˆã‚ŠåˆæœŸå€¤{}ã‹ã‚‰nullã«å¤‰æ›´ã•ã‚Œ$store.watchãŒç™ºç«ã™ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

ã“ã“ã¾ã§ã§ã€éãƒ­ã‚°ã‚¤ãƒ³æ™‚ã«ãƒã‚¤ãƒšãƒ¼ã‚¸ã‚„ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸ã«è¡Œã£ã¦ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚
ï¼ˆåŒã˜ã‚ˆã†ã«loginãƒšãƒ¼ã‚¸ã¨signupãƒšãƒ¼ã‚¸ã«ã‚‚ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã„ãŸã‚‰ãƒã‚¤ãƒšãƒ¼ã‚¸ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã•ã›ã‚‹å‡¦ç†ã‚’æ›¸ã„ã¦ãŠãã¨è‰¯ã„ã§ã—ã‚‡ã†ã€‚ï¼‰


## Vuexã®ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°

ä»Šã¾ã§ã¯signupã‚„loginãªã©ãƒšãƒ¼ã‚¸ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ä¸­ã§APIã‚’å©ãå‡¦ç†ã‚’æ›¸ã„ã¦ã„ã¾ã—ãŸã€‚
ã“ã‚Œã‚’actionsã«ç§»è¡Œã—ã¾ã™ã€‚
ãã®å‰ã«ã›ã£ã‹ããªã®ã§stateã¨mutationsã¨actionsãã‚Œãã‚Œåˆ¥ãƒ•ã‚¡ã‚¤ãƒ«ã«åˆ†å‰²ã—ã¨ãã¾ã™ã€‚



```store/auth.js
import firebase from "@/plugins/firebase";
export const state = () => ({
  currentUser: {}
});

export const mutations = {
  setUser(state, payload) {
    state.currentUser = payload
  },
};

export const actions = {
  async login({
    commit,
  }, payload) {
    await firebase
      .auth()
      .signInWithEmailAndPassword(payload.email, payload.password)
      .catch((error) => {
        console.log(error);
        this.error = ((code) => {
          switch (code) {
            case "auth/user-not-found":
              return "ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒé–“é•ã£ã¦ã„ã¾ã™";
            case "auth/wrong-password":
              return "â€»ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“";
            default:
              return "â€»ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ã”ç¢ºèªãã ã•ã„";
          }
        })(error.code);
      });

    commit("notification/setNotice", "ãƒ­ã‚°ã‚¤ãƒ³ã—ã¾ã—ãŸ", { root: true });
    setTimeout(() => {
      commit("notification/setNotice", "", { root: true });
    }, 2000);

    this.$router.push("/");
  },
};
```

ä»Šå›ã¯authãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ä¸­ã§notificationãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’å‘¼ã³å‡ºãã†ã¨ã™ã‚‹ã®ã§
{ root: true }ã‚’ç¬¬3å¼•æ•°ã«æ¸¡ã™ã“ã¨ã§rootèµ·ç‚¹ã§å‘¼ã³å‡ºã›ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚


loginãƒšãƒ¼ã‚¸ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ã¯ã“ã®actionsã‚’å©ãã«è¡Œãã¾ã™ã€‚

```javascript:pages/login.vue
 methods: {
    login() {
      this.$store.dispatch("login", {
        email: this.email,
        password: this.password
      });
    }
  }
```

åŒã˜ã‚ˆã†ã«ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã‚„æ–°è¦ç™»éŒ²ã®å‡¦ç†ã‚‚actionsã«ç§»å‹•ã•ã›ã¦ã¿ã‚‹ã¨è‰¯ã„ã§ã—ã‚‡ã†ã€‚



# ãƒ‡ãƒ—ãƒ­ã‚¤
Railsã®APIã¯**Heroku**ã«(é¸æŠè‚¢: EC2ã§ã‚‚GAE)
Nuxtã¯**Firebase Hosting**ã«(é¸æŠè‚¢: netlify, surge, now)

## Railsã®ãƒ‡ãƒ—ãƒ­ã‚¤
https://qiita.com/kazukimatsumoto/items/a0daa7281a3948701c39
Herokuã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤ã¯ã“ã®è¨˜äº‹ã‚’å‚è€ƒã«ã•ã›ã¦ã„ãŸã ãã¾ã™ã€‚



```config/database.yml
production:
  <<: *default
  adapter: postgresql
  encoding: unicode
  pool: 5
```


sqlite3ã‚’é–‹ç™ºãƒ»ãƒ†ã‚¹ãƒˆç’°å¢ƒã®ã¿ã«é©ç”¨ã—ã¦pgã‚’æœ¬ç•ªç’°å¢ƒç”¨ã«è¿½åŠ ã—ã¾ã™ã€‚

```Gemfile
group :development, :test do
  gem 'sqlite3'
end

group :production do
  gem 'pg'
end
```

```
api $ bundle install --without production
api $ heroku create ã‚¢ãƒ—ãƒªå
api $ git push heroku master 
api $ heroku run rails db:migrate
```
heroku openã§/v1/usersã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ç©ºé…åˆ—ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚Œã°okã§ã™ï¼




## Nuxtã®ãƒ‡ãƒ—ãƒ­ã‚¤
ãƒ‡ãƒ—ãƒ­ã‚¤å‰ã«ç’°å¢ƒå¤‰æ•°ã®è¨­å®šã‚’å¤‰æ›´ã—ã¦ãŠãã¾ã™ã€‚


```.env
API_ENDPOINT="Herokuã®URL"
```

ãƒ‡ãƒ—ãƒ­ã‚¤ã¯firebase deployã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ã£ã¦è¡Œã„ã¾ã™ãŒã€
firebase.jsonã¨ã„ã†ãƒ•ã‚¡ã‚¤ãƒ«ãŒã¾ã ãªã„ã®ã§ä½œã‚Šã¾ã™ã€‚

```terminal
web $ firebase init
```
ã“ã®ã‚³ãƒãƒ³ãƒ‰ã‚’æ‰“ã¤ã¨FIrebaseã®ãƒ­ã‚´ãŒå‡ºã¦ãã¦ã„ãã¤ã‹è³ªå•ã‚’ã•ã‚Œã‚‹ã¨æ€ã„ã¾ã™ã€‚


<img width="977" alt="ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ 2020-01-05 7.01.12.png" src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/251768/224b6b7e-bf4e-9fe1-2974-58ff45f3b70f.png">
ä¸€æ—¦Hostingã®ã¿ã‚’é¸æŠã—ã¾ã™ã€‚(ã‚¹ãƒšãƒ¼ã‚¹ã‚­ãƒ¼ã§é¸æŠã®å¾ŒEnter)

ãƒ»Please select an option: Use an existing project

ãƒ»Select a default Firebase project for this directory: qiita-todo
ä½œæˆæ¸ˆã¿ã®Firebaseãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’é¸æŠã—ã¾ã™ã€‚

ãƒ» What do you want to use as your public directory? dist
ã“ã“ã§ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§publicã¨ãªã£ã¦ã„ã¾ã™ãŒã€distã¨å…¥åŠ›ã—ã¦enterã‚’æŠ¼ã—ã¾ã™ã€‚

ãƒ» Configure as a single-page app (rewrite all urls to /index.html)? y
SPAãªã®ã§yesã§

ä¸Šæ‰‹ãã„ãã¨ã“ã‚“ãªæ„Ÿã˜ã«
<img width="681" alt="ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ 2020-01-05 7.06.41.png" src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/251768/e7b52b21-99db-4dd0-1ce1-03dd4c8ef178.png">



[Nuxt SPAãƒ¢ãƒ¼ãƒ‰ã®ãƒ‡ãƒ—ãƒ­ã‚¤](https://ja.nuxtjs.org/guide/commands/#%E3%82%B7%E3%83%B3%E3%82%B0%E3%83%AB%E3%83%9A%E3%83%BC%E3%82%B8%E3%82%A2%E3%83%97%E3%83%AA%E3%82%B1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4-spa-)ã¯å…¬å¼ã«å¾“ã£ã¦è¡Œã„ã¾ã™ã€‚

```
web $ npm run build
```
ã“ã®ã‚³ãƒãƒ³ãƒ‰ã‚’æ‰“ã¤ã¨package.jsonã®scripts.devã®nuxtã‚³ãƒãƒ³ãƒ‰ãŒå‘¼ã°ã‚Œ
distãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªé…ä¸‹ã«buildã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ãŒæ ¼ç´ã•ã‚Œã¾ã™ã€‚
å…ˆã»ã©firebase initã‚³ãƒãƒ³ãƒ‰ã§è³ªå•ã•ã‚ŒãŸéš›ã«distãƒ•ã‚©ãƒ«ãƒ€ã‚’æŒ‡å®šã—ãŸã®ã¯ã“ã®ãŸã‚ã§ã™ã€‚

```
web $ firebase deploy
```
ã“ã®ã‚³ãƒãƒ³ãƒ‰ã¯.firebasercã‚’èª­ã¿è¾¼ã¿ã€**distãƒ•ã‚©ãƒ«ãƒ€**ã‚’.firebasercè¨˜è¼‰ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå®›ã«ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’é–‹å§‹ã—ã¾ã™ã€‚

ãƒ‡ãƒ—ãƒ­ã‚¤ãŒå®Œäº†ã™ã‚‹ã¨ä»¥ä¸‹ã®ã‚ˆã†ãªæ„Ÿã˜ã«ãªã‚‹ã¨æ€ã„ã¾ã™ã€‚

<img width="675" alt="ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ 2020-01-05 7.09.08.png" src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/251768/16c028b8-991a-210a-161c-7346e011a27a.png">
ã‚ã¨ã¯Hosting URLã§è¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹URLã‚’ãƒ–ãƒ©ã‚¦ã‚¶ã§ç¢ºèªã§ãã‚Œã°å®Œäº†ã§ã™ã€‚


# CORSå´ã®å†è¨­å®š
ç¾çŠ¶**rack-cors**ã®è¨­å®šã¯ãƒ•ãƒ«ã‚ªãƒ¼ãƒ—ãƒ³ã«ãªã£ã¦ã—ã¾ã£ã¦ã„ã‚‹ã®ã§ã€é–‹ç™ºç’°å¢ƒã¨æœ¬ç•ªç’°å¢ƒã§è¨±å®¹ã™ã‚‹ã‚ªãƒªã‚¸ãƒ³ã‚’æ¡ä»¶åˆ†å²ã—ã¦ãŠãã¨è‰¯ã„ã§ã—ã‚‡ã†ã€‚ä¿®æ­£ãŒå®Œäº†ã—ãŸã‚‰git commitã—ã¦git push heroku masterã§å¤‰æ›´ã‚’åæ˜ ã•ã›ã¾ã™ã€‚

```config/initializers/cors.rb
Rails.application.config.middleware.insert_before 0, Rack::Cors do
  allow do
    ## origins '*' 
    if Rails.env.production?
        origins 'https://qiita-todo.firebaseapp.com' 
    else 
        origins 'http://localhost:3000'
    end
   
    resource '*',
      headers: :any,
      methods: [:get, :post, :put, :patch, :delete, :options, :head]
  end
end
```

## è£œè¶³
ãƒ•ãƒ­ãƒ³ãƒˆå´ã®ã‚³ãƒ¼ãƒ‰ã‚’ç·¨é›†ã—ã€ãã‚Œã‚’æœ¬ç•ªç’°å¢ƒã«åæ˜ ã•ã›ãŸã„æ™‚ã¯
**npm run build**ã¨**firebase deploy**ã‚’ç¹°ã‚Šè¿”ã™ã ã‘ã§okã§ã™ã€‚

â€»ä»Šã®ã¾ã¾ã§ã¯é–‹ç™ºç’°å¢ƒã¨æœ¬ç•ªç’°å¢ƒã‚’è¡Œãæ¥ã™ã‚‹åº¦ã«ã€.env(ç’°å¢ƒå¤‰æ•°)ã®å€¤ã‚’æ¯å›å¤‰ãˆãªãã§ã¯ãªã‚‰ãªã„ã®ã§
[cross-env](https://github.com/kentcdodds/cross-env)ã¨ã„ã†ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ã†ã¨ç°¡å˜ã«é–‹ç™ºç’°å¢ƒã¨æœ¬ç•ªç’°å¢ƒã§ç’°å¢ƒå¤‰æ•°ã‚’ä½¿ã„åˆ†ã‘ã‚‹ã®ã§ä¾¿åˆ©ã§ã™ã€‚


# æœ€å¾Œã«
ã“ã“ã¾ã§ã§ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã¯çµ‚äº†ã§ã™ã€‚
ç¾çŠ¶ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®åˆ†ã‘æ–¹ãŒé›‘ãªã®ã§ã€**atomic design**ã‚’å°å…¥ã—ã¦ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’æ•´ç†ã—ã¦ã¿ã‚‹ã¨è‰¯ã„ã§ã—ã‚‡ã†ã€‚
ã“ã®è¨˜äº‹ã§ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãƒ™ãƒ¼ã‚¹ã§é–‹ç™ºã‚’é€²ã‚ã¦ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®APIã‚’å©ãã«è¡Œãä¸€é€£ã®æµã‚ŒãŒç†è§£ã—ã¦ã„ãŸã ã‘ã‚Œã„ã‚Œã°å¹¸ã„ã§ã™ã€‚ã¾ãŸã€ä»–ã®æŠ€è¡“ã§ã®çµ„ã¿åˆã‚ã›ã‚‚è©¦ã—ã¦ã¿ãŸã‚Šã™ã‚‹ã¨é¢ç™½ã„ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚

â€»å…ˆè¼©ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã®æ–¹ã€…ã€é–“é•ã£ã¦ã„ã‚‹ã¨ã“ã‚ã‚„ã‚‚ã£ã¨ã“ã†ã™ã¹ãã¿ãŸã„ãªã‚¢ãƒ‰ãƒã‚¤ã‚¹ãŒã‚ã‚Œã°æŒ‡æ‘˜ã—ã¦ã„ãŸã ã‘ã‚Œã°å¹¸ã„ã§ã™ã€‚
â€»ã‚ã‹ã‚‰ãªã„ç®‡æ‰€ã¯Twiiterã§DMãã‚Œã‚Œã°å¯¾å¿œã—ã¾ã™ã®ã§ãŠæ°—è»½ã«ï¼
ç­†è€…ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ => https://twitter.com/gigig826
